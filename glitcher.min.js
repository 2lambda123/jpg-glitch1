/**
 * @license almond 0.3.1 Copyright (c) 2011-2014, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/jrburke/almond for details
 */

/*!
  * Reqwest! A general purpose XHR connection manager
  * license MIT (c) Dustin Diaz 2015
  * https://github.com/ded/reqwest
  */

/*!
    localForage -- Offline Storage, Improved
    Version 1.3.1
    https://mozilla.github.io/localForage
    (c) 2013-2015 Mozilla, Apache License 2.0
*/

/*
	 * Includes code from:
	 *
	 * base64-arraybuffer
	 * https://github.com/niklasvh/base64-arraybuffer
	 *
	 * Copyright (c) 2012 Niklas von Hertzen
	 * Licensed under the MIT license.
	 */

/*
 * JavaScript MD5 1.0.1
 * https://github.com/blueimp/JavaScript-MD5
 *
 * Copyright 2011, Sebastian Tschan
 * https://blueimp.net
 *
 * Licensed under the MIT license:
 * http://www.opensource.org/licenses/MIT
 * 
 * Based on
 * A JavaScript implementation of the RSA Data Security, Inc. MD5 Message
 * Digest Algorithm, as defined in RFC 1321.
 * Version 2.2 Copyright (C) Paul Johnston 1999 - 2009
 * Other contributors: Greg Holt, Andrew Kepert, Ydnar, Lostinet
 * Distributed under the BSD License
 * See http://pajhome.org.uk/crypt/md5 for more info.
 */

(function(){var requirejs,require,define;(function(e){function h(e,t){return f.call(e,t)}function p(e,t){var n,r,i,s,o,a,f,l,h,p,d,v=t&&t.split("/"),m=u.map,g=m&&m["*"]||{};if(e&&e.charAt(0)===".")if(t){e=e.split("/"),o=e.length-1,u.nodeIdCompat&&c.test(e[o])&&(e[o]=e[o].replace(c,"")),e=v.slice(0,v.length-1).concat(e);for(h=0;h<e.length;h+=1){d=e[h];if(d===".")e.splice(h,1),h-=1;else if(d===".."){if(h===1&&(e[2]===".."||e[0]===".."))break;h>0&&(e.splice(h-1,2),h-=2)}}e=e.join("/")}else e.indexOf("./")===0&&(e=e.substring(2));if((v||g)&&m){n=e.split("/");for(h=n.length;h>0;h-=1){r=n.slice(0,h).join("/");if(v)for(p=v.length;p>0;p-=1){i=m[v.slice(0,p).join("/")];if(i){i=i[r];if(i){s=i,a=h;break}}}if(s)break;!f&&g&&g[r]&&(f=g[r],l=h)}!s&&f&&(s=f,a=l),s&&(n.splice(0,a,s),e=n.join("/"))}return e}function d(t,r){return function(){var i=l.call(arguments,0);return typeof i[0]!="string"&&i.length===1&&i.push(null),n.apply(e,i.concat([t,r]))}}function v(e){return function(t){return p(t,e)}}function m(e){return function(t){s[e]=t}}function g(n){if(h(o,n)){var r=o[n];delete o[n],a[n]=!0,t.apply(e,r)}if(!h(s,n)&&!h(a,n))throw new Error("No "+n);return s[n]}function y(e){var t,n=e?e.indexOf("!"):-1;return n>-1&&(t=e.substring(0,n),e=e.substring(n+1,e.length)),[t,e]}function b(e){return function(){return u&&u.config&&u.config[e]||{}}}var t,n,r,i,s={},o={},u={},a={},f=Object.prototype.hasOwnProperty,l=[].slice,c=/\.js$/;r=function(e,t){var n,r=y(e),i=r[0];return e=r[1],i&&(i=p(i,t),n=g(i)),i?n&&n.normalize?e=n.normalize(e,v(t)):e=p(e,t):(e=p(e,t),r=y(e),i=r[0],e=r[1],i&&(n=g(i))),{f:i?i+"!"+e:e,n:e,pr:i,p:n}},i={require:function(e){return d(e)},exports:function(e){var t=s[e];return typeof t!="undefined"?t:s[e]={}},module:function(e){return{id:e,uri:"",exports:s[e],config:b(e)}}},t=function(t,n,u,f){var l,c,p,v,y,b=[],w=typeof u,E;f=f||t;if(w==="undefined"||w==="function"){n=!n.length&&u.length?["require","exports","module"]:n;for(y=0;y<n.length;y+=1){v=r(n[y],f),c=v.f;if(c==="require")b[y]=i.require(t);else if(c==="exports")b[y]=i.exports(t),E=!0;else if(c==="module")l=b[y]=i.module(t);else if(h(s,c)||h(o,c)||h(a,c))b[y]=g(c);else{if(!v.p)throw new Error(t+" missing "+c);v.p.load(v.n,d(f,!0),m(c),{}),b[y]=s[c]}}p=u?u.apply(s[t],b):undefined;if(t)if(l&&l.exports!==e&&l.exports!==s[t])s[t]=l.exports;else if(p!==e||!E)s[t]=p}else t&&(s[t]=u)},requirejs=require=n=function(s,o,a,f,l){if(typeof s=="string")return i[s]?i[s](o):g(r(s,o).f);if(!s.splice){u=s,u.deps&&n(u.deps,u.callback);if(!o)return;o.splice?(s=o,o=a,a=null):s=e}return o=o||function(){},typeof a=="function"&&(a=f,f=l),f?t(e,s,o,a):setTimeout(function(){t(e,s,o,a)},4),n},n.config=function(e){return n(e)},requirejs._defined=s,define=function(e,t,n){if(typeof e!="string")throw new Error("See almond README: incorrect module build, no module name");t.splice||(n=t,t=[]),!h(s,e)&&!h(o,e)&&(o[e]=[e,t,n])},define.amd={jQuery:!0}})(),define("lib/almond",function(){}),define("config",[],function(){return{keys:{imgur:"a4c24380d884932",storage:"glitch-items",settings:"settings",language:"language"},defaultControlParams:{amount:{min:0,max:99,value:24},seed:{min:0,max:100,value:53},iterations:{min:0,max:100,value:21},quality:{min:1,max:99,value:46}},defaultImage:{name:"AbrahamLincoln",path:"images/lincoln.jpg"},workers:{glitch:"glitchworker.min.js",storage:"storageworker.min.js",settings:"settingsworker.min.js"},language:{dir:"lang",preset:"en-us",debug:window.location.hash.indexOf("languagedebug")!==-1},settings:{canZoomWithPointer:{value:!0},resizeUploadedImages:{value:!0},language:{value:"en-us",options:["en-us","en-gb","de-de","ru-ru"]}},localForage:{name:"glitchtool",storeName:"keyvaluepairs"},origin:location.protocol+"//"+location.host+(location.port!==""?":"+location.port:""),share:{appURL:"https://snorpey.github.io/jpg-glitch",sharer:{facebook:"https://www.facebook.com/sharer/sharer.php",twitter:"https://twitter.com/intent/tweet",reddit:"https://www.reddit.com/submit",pinterest:"https://pinterest.com/pin/create/button/",vkontakte:"http://vk.com/share.php"}}}}),define("util/string",[],function(){function e(e){e&&Array.isArray(e)&&(e=e.join(" "));var t=e.split(/(-|\s|_)/gmi),n="";return t.forEach(function(e,t){e.match(/(-|\s|_)/gmi)||(t>0&&e.length>1?n+=e.charAt(0).toUpperCase()+e.slice(1):n+=e)}),n}function t(e,t){return r(n(e,t.links),t.autop)}function n(e,t){e=e||"";var n=[],r="";t&&(t.newTab&&n.push('target="_blank"'),t.cssClasses&&n.push('class="'+cssClasses+'"')),r=n.length?" "+n.join(" "):"";var i='<a href="$2"'+r+">$1</a>";return e.replace(/\\n/gm,"\n").replace(/\[(.*?)\]\((.+?)\)/g,i)}function r(e,t){e=e||"";var n=t&&t.tag?t.tag:"p",r=t&&t.linebreak?"<"+t.linebreak+">":"<br />",i="<"+n+">",s="</"+n+">";return t&&t.cssClasses&&typeof t.cssClasses=="string"&&(i="<"+n+' class="'+t.cssClasses+'">'),i+e.replace(/\n{2}/g,"&nbsp;"+s+i).replace(/\n/g,"&nbsp;"+r)+s}function i(e,t){var n=[];for(var r in e)if(e.hasOwnProperty(r)){var s=t?t+"["+r+"]":r,o=e[r];n.push(typeof o=="object"?i(o,s):encodeURIComponent(s)+"="+encodeURIComponent(o))}return n.join("&")}return{toCamelCase:e,autop:r,markdownToHtml:t,markdownLinksToHtml:n,objToQueryStr:i}}),define("util/browser",["util/string"],function(e){function i(e){return typeof n[e]!="undefined"?n[e]:(n[e]=r[e]?r[e]():!1,n[e])}function s(n,r){var i=o(n,r);if(!i)for(var s=0,u=t.length;s<u;s++){if(!!i)break;i=o(n,e.toCamelCase(t[s]+"-"+r))}return i}function o(e,t){return e[t]}var t=["webkit","moz","ms","o"],n={},r={getusermedia:function(){return navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia},fullscreen:function(){return!!s(document,"fullScreenEnabled")||!!s(document,"fullscreenEnabled")},browserdb:function(){return s(window,"indexedDB")||s(window,"openDatabase")},browserstorage:function(){return i("browserdb")||s(window,"localStorage")},draganddrop:function(){return"draggable"in document.createElement("span")},touch:function(){return"ontouchstart"in window},webworker:function(){return"Worker"in window},promise:function(){return"Promise"in window},localforage:function(){return i("promise")&&i("browserstorage")},safari:function(){return/^((?!chrome|android).)*safari/i.test(navigator.userAgent)}};return{getFeature:s,test:i}}),define("util/dom",[],function(){function e(e,t){e.style.transform=e.style.webkitTransform=e.style.msTransform=t}function t(e,t){var n=t.parentNode;while(n!=null){if(n==e)return!0;n=n.parentNode}return!1}function n(e){return typeof HTMLElement=="object"?e instanceof HTMLElement:e&&typeof e=="object"&&e!==null&&e.nodeType===1&&typeof e.nodeName=="string"}return{setTransform:e,isDescendant:t,isElement:n}}),define("util/object",[],function(){function e(e,t){if(typeof e=="string"){e=e.replace(/\[(\w+)\]/g,".$1"),e=e.replace(/^\./,"");var n=e.split(".");for(var r=0,i=n.length;r<i;++r){var s=n[r];if(!(s in t))return;t=t[s]}}return t}function t(e){return JSON.parse(JSON.stringify(e))}function n(e,t){return JSON.stringify(e)===JSON.stringify(t)}function r(e,n){e=t(e),n=t(n);for(var i in n)try{typeof n[i]=="object"?e[i]=r(e[i],n[i]):typeof e[i]=="undefined"&&typeof n[i]!="undefined"&&(e[i]=n[i])}catch(s){e[i]=n[i]}return e}return{getObjectByString:e,getCopy:t,merge:r,isEqual:n}}),define("util/addpublishers",["util/object"],function(e){function t(){function s(e){var t=[],r=Object.keys(i);typeof e=="string"&&(t=t.concat(e.split(" "))),Array.isArray(e)&&(t=t.concat(e)),t=t.filter(function(e){return r.indexOf(e)===-1&&n.indexOf(e)===-1?!0:!1}),n=n.concat(t)}function o(n,r){if(typeof n=="string"&&n.indexOf(".")!==-1){var s=n.split("."),n=s.pop(),o=e.getObjectByString(s.join("."),i);o&&typeof o.on=="function"&&o.on(n,r)}else f(n)&&typeof r=="function"&&t[n].push(r);return i}function u(e,n){if(typeof e=="string"&&typeof n=="function"&&t[e])for(var r=t[e].length;r>=0;r--)t[e][r]===n&&t[e].splice(r,1);return i}function a(e){var n=Array.prototype.slice.call(arguments).slice(1);return Array.isArray(t[e])&&t[e].forEach(function(e){e.apply(e,n)}),i}function f(e){return n?n.indexOf(e)>-1:!0}var t={},n=[],r=Array.prototype.slice.call(arguments),i=r.shift();return i&&r.length&&r.forEach(s),n.forEach(function(e){i[e]||(i[e]={}),i[e].dispatch=function(){a.apply(a,[e].concat(Array.prototype.slice.call(arguments)))},t[e]||(t[e]=[]),t[e].dispatch=function(){a.apply(a,[e].concat(Array.prototype.slice.call(arguments)))}}),t.dispatch=a,i.on=o,i.off=u,t}return t}),!function(e,t,n){typeof module!="undefined"&&module.exports?module.exports=n():typeof define=="function"&&define.amd?define("lib/reqwest",n):t[e]=n()}("reqwest",this,function(){function succeed(e){var t=protocolRe.exec(e.url);return t=t&&t[1]||context.location.protocol,httpsRe.test(t)?twoHundo.test(e.request.status):!!e.request.response}function handleReadyState(e,t,n){return function(){if(e._aborted)return n(e.request);if(e._timedOut)return n(e.request,"Request is aborted: timeout");e.request&&e.request[readyState]==4&&(e.request.onreadystatechange=noop,succeed(e)?t(e.request):n(e.request))}}function setHeaders(e,t){var n=t.headers||{},r;n.Accept=n.Accept||defaultHeaders.accept[t.type]||defaultHeaders.accept["*"];var i=typeof FormData=="function"&&t.data instanceof FormData;!t.crossOrigin&&!n[requestedWith]&&(n[requestedWith]=defaultHeaders.requestedWith),!n[contentType]&&!i&&(n[contentType]=t.contentType||defaultHeaders.contentType);for(r in n)n.hasOwnProperty(r)&&"setRequestHeader"in e&&e.setRequestHeader(r,n[r])}function setCredentials(e,t){typeof t.withCredentials!="undefined"&&typeof e.withCredentials!="undefined"&&(e.withCredentials=!!t.withCredentials)}function generalCallback(e){lastValue=e}function urlappend(e,t){return e+(/\?/.test(e)?"&":"?")+t}function handleJsonp(e,t,n,r){var i=uniqid++,s=e.jsonpCallback||"callback",o=e.jsonpCallbackName||reqwest.getcallbackPrefix(i),u=new RegExp("((^|\\?|&)"+s+")=([^&]+)"),a=r.match(u),f=doc.createElement("script"),l=0,c=navigator.userAgent.indexOf("MSIE 10.0")!==-1;return a?a[3]==="?"?r=r.replace(u,"$1="+o):o=a[3]:r=urlappend(r,s+"="+o),context[o]=generalCallback,f.type="text/javascript",f.src=r,f.async=!0,typeof f.onreadystatechange!="undefined"&&!c&&(f.htmlFor=f.id="_reqwest_"+i),f.onload=f.onreadystatechange=function(){if(f[readyState]&&f[readyState]!=="complete"&&f[readyState]!=="loaded"||l)return!1;f.onload=f.onreadystatechange=null,f.onclick&&f.onclick(),t(lastValue),lastValue=undefined,head.removeChild(f),l=1},head.appendChild(f),{abort:function(){f.onload=f.onreadystatechange=null,n({},"Request is aborted: timeout",{}),lastValue=undefined,head.removeChild(f),l=1}}}function getRequest(e,t){var n=this.o,r=(n.method||"GET").toUpperCase(),i=typeof n=="string"?n:n.url,s=n.processData!==!1&&n.data&&typeof n.data!="string"?reqwest.toQueryString(n.data):n.data||null,o,u=!1;return(n["type"]=="jsonp"||r=="GET")&&s&&(i=urlappend(i,s),s=null),n["type"]=="jsonp"?handleJsonp(n,e,t,i):(o=n.xhr&&n.xhr(n)||xhr(n),o.open(r,i,n.async===!1?!1:!0),setHeaders(o,n),setCredentials(o,n),context[xDomainRequest]&&o instanceof context[xDomainRequest]?(o.onload=e,o.onerror=t,o.onprogress=function(){},u=!0):o.onreadystatechange=handleReadyState(this,e,t),n.before&&n.before(o),u?setTimeout(function(){o.send(s)},200):o.send(s),o)}function Reqwest(e,t){this.o=e,this.fn=t,init.apply(this,arguments)}function setType(e){if(e===null)return undefined;if(e.match("json"))return"json";if(e.match("javascript"))return"js";if(e.match("text"))return"html";if(e.match("xml"))return"xml"}function init(o,fn){function complete(e){o.timeout&&clearTimeout(self.timeout),self.timeout=null;while(self._completeHandlers.length>0)self._completeHandlers.shift()(e)}function success(resp){var type=o.type||resp&&setType(resp.getResponseHeader("Content-Type"));resp=type!=="jsonp"?self.request:resp;var filteredResponse=globalSetupOptions.dataFilter(resp.responseText,type),r=filteredResponse;try{resp.responseText=r}catch(e){}if(r)switch(type){case"json":try{resp=context.JSON?context.JSON.parse(r):eval("("+r+")")}catch(err){return error(resp,"Could not parse JSON in response",err)}break;case"js":resp=eval(r);break;case"html":resp=r;break;case"xml":resp=resp.responseXML&&resp.responseXML.parseError&&resp.responseXML.parseError.errorCode&&resp.responseXML.parseError.reason?null:resp.responseXML}self._responseArgs.resp=resp,self._fulfilled=!0,fn(resp),self._successHandler(resp);while(self._fulfillmentHandlers.length>0)resp=self._fulfillmentHandlers.shift()(resp);complete(resp)}function timedOut(){self._timedOut=!0,self.request.abort()}function error(e,t,n){e=self.request,self._responseArgs.resp=e,self._responseArgs.msg=t,self._responseArgs.t=n,self._erred=!0;while(self._errorHandlers.length>0)self._errorHandlers.shift()(e,t,n);complete(e)}this.url=typeof o=="string"?o:o.url,this.timeout=null,this._fulfilled=!1,this._successHandler=function(){},this._fulfillmentHandlers=[],this._errorHandlers=[],this._completeHandlers=[],this._erred=!1,this._responseArgs={};var self=this;fn=fn||function(){},o.timeout&&(this.timeout=setTimeout(function(){timedOut()},o.timeout)),o.success&&(this._successHandler=function(){o.success.apply(o,arguments)}),o.error&&this._errorHandlers.push(function(){o.error.apply(o,arguments)}),o.complete&&this._completeHandlers.push(function(){o.complete.apply(o,arguments)}),this.request=getRequest.call(this,success,error)}function reqwest(e,t){return new Reqwest(e,t)}function normalize(e){return e?e.replace(/\r?\n/g,"\r\n"):""}function serial(e,t){var n=e.name,r=e.tagName.toLowerCase(),i=function(e){e&&!e.disabled&&t(n,normalize(e.attributes.value&&e.attributes.value.specified?e.value:e.text))},s,o,u,a;if(e.disabled||!n)return;switch(r){case"input":/reset|button|image|file/i.test(e.type)||(s=/checkbox/i.test(e.type),o=/radio/i.test(e.type),u=e.value,(!s&&!o||e.checked)&&t(n,normalize(s&&u===""?"on":u)));break;case"textarea":t(n,normalize(e.value));break;case"select":if(e.type.toLowerCase()==="select-one")i(e.selectedIndex>=0?e.options[e.selectedIndex]:null);else for(a=0;e.length&&a<e.length;a++)e.options[a].selected&&i(e.options[a])}}function eachFormElement(){var e=this,t,n,r=function(t,n){var r,i,s;for(r=0;r<n.length;r++){s=t[byTag](n[r]);for(i=0;i<s.length;i++)serial(s[i],e)}};for(n=0;n<arguments.length;n++)t=arguments[n],/input|select|textarea/i.test(t.tagName)&&serial(t,e),r(t,["input","select","textarea"])}function serializeQueryString(){return reqwest.toQueryString(reqwest.serializeArray.apply(null,arguments))}function serializeHash(){var e={};return eachFormElement.apply(function(t,n){t in e?(e[t]&&!isArray(e[t])&&(e[t]=[e[t]]),e[t].push(n)):e[t]=n},arguments),e}function buildParams(e,t,n,r){var i,s,o,u=/\[\]$/;if(isArray(t))for(s=0;t&&s<t.length;s++)o=t[s],n||u.test(e)?r(e,o):buildParams(e+"["+(typeof o=="object"?s:"")+"]",o,n,r);else if(t&&t.toString()==="[object Object]")for(i in t)buildParams(e+"["+i+"]",t[i],n,r);else r(e,t)}var context=this;if("window"in context)var doc=document,byTag="getElementsByTagName",head=doc[byTag]("head")[0];else{var XHR2;try{var xhr2="xhr2";XHR2=require(xhr2)}catch(ex){throw new Error("Peer dependency `xhr2` required! Please npm install xhr2")}}var httpsRe=/^http/,protocolRe=/(^\w+):\/\//,twoHundo=/^(20\d|1223)$/,readyState="readyState",contentType="Content-Type",requestedWith="X-Requested-With",uniqid=0,callbackPrefix="reqwest_"+ +(new Date),lastValue,xmlHttpRequest="XMLHttpRequest",xDomainRequest="XDomainRequest",noop=function(){},isArray=typeof Array.isArray=="function"?Array.isArray:function(e){return e instanceof Array},defaultHeaders={contentType:"application/x-www-form-urlencoded",requestedWith:xmlHttpRequest,accept:{"*":"text/javascript, text/html, application/xml, text/xml, */*",xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript",js:"application/javascript, text/javascript"}},xhr=function(e){if(e.crossOrigin===!0){var t=context[xmlHttpRequest]?new XMLHttpRequest:null;if(t&&"withCredentials"in t)return t;if(context[xDomainRequest])return new XDomainRequest;throw new Error("Browser does not support cross-origin requests")}return context[xmlHttpRequest]?new XMLHttpRequest:XHR2?new XHR2:new ActiveXObject("Microsoft.XMLHTTP")},globalSetupOptions={dataFilter:function(e){return e}};return Reqwest.prototype={abort:function(){this._aborted=!0,this.request.abort()},retry:function(){init.call(this,this.o,this.fn)},then:function(e,t){return e=e||function(){},t=t||function(){},this._fulfilled?this._responseArgs.resp=e(this._responseArgs.resp):this._erred?t(this._responseArgs.resp,this._responseArgs.msg,this._responseArgs.t):(this._fulfillmentHandlers.push(e),this._errorHandlers.push(t)),this},always:function(e){return this._fulfilled||this._erred?e(this._responseArgs.resp):this._completeHandlers.push(e),this},fail:function(e){return this._erred?e(this._responseArgs.resp,this._responseArgs.msg,this._responseArgs.t):this._errorHandlers.push(e),this},"catch":function(e){return this.fail(e)}},reqwest.serializeArray=function(){var e=[];return eachFormElement.apply(function(t,n){e.push({name:t,value:n})},arguments),e},reqwest.serialize=function(){if(arguments.length===0)return"";var e,t,n=Array.prototype.slice.call(arguments,0);return e=n.pop(),e&&e.nodeType&&n.push(e)&&(e=null),e&&(e=e.type),e=="map"?t=serializeHash:e=="array"?t=reqwest.serializeArray:t=serializeQueryString,t.apply(null,n)},reqwest.toQueryString=function(e,t){var n,r,i=t||!1,s=[],o=encodeURIComponent,u=function(e,t){t="function"==typeof t?t():t==null?"":t,s[s.length]=o(e)+"="+o(t)};if(isArray(e))for(r=0;e&&r<e.length;r++)u(e[r].name,e[r].value);else for(n in e)e.hasOwnProperty(n)&&buildParams(n,e[n],i,u);return s.join("&").replace(/%20/g,"+")},reqwest.getcallbackPrefix=function(){return callbackPrefix},reqwest}),"Promise"in(typeof window!="undefined"?window:self)&&function(t,n){typeof exports=="object"&&typeof module=="object"?module.exports=n():typeof define=="function"&&define.amd?define("lib/localforage.nopromises",[],n):typeof exports=="object"?exports.localforage=n():t.localforage=n()}(this,function(){return function(e){function n(r){if(t[r])return t[r].exports;var i=t[r]={exports:{},id:r,loaded:!1};return e[r].call(i.exports,i,i.exports,n),i.loaded=!0,i.exports}var t={};return n.m=e,n.c=t,n.p="",n(0)}([function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}t.__esModule=!0,function(){function l(e,t){e[t]=function(){var n=arguments;return e.ready().then(function(){return e[t].apply(e,n)})}}function c(){for(var e=1;e<arguments.length;e++){var t=arguments[e];if(t)for(var n in t)t.hasOwnProperty(n)&&(f(t[n])?arguments[0][n]=t[n].slice():arguments[0][n]=t[n])}return arguments[0]}function h(e){for(var t in i)if(i.hasOwnProperty(t)&&i[t]===e)return!0;return!1}var e={},i={INDEXEDDB:"asyncStorage",LOCALSTORAGE:"localStorageWrapper",WEBSQL:"webSQLStorage"},s=[i.INDEXEDDB,i.WEBSQL,i.LOCALSTORAGE],o=["clear","getItem","iterate","key","keys","length","removeItem","setItem"],u={description:"",driver:s.slice(),name:"localforage",size:4980736,storeName:"keyvaluepairs",version:1},a=function(e){var t=t||e.indexedDB||e.webkitIndexedDB||e.mozIndexedDB||e.OIndexedDB||e.msIndexedDB,n={};return n[i.WEBSQL]=!!e.openDatabase,n[i.INDEXEDDB]=!!function(){if(typeof e.openDatabase!="undefined"&&e.navigator&&e.navigator.userAgent&&/Safari/.test(e.navigator.userAgent)&&!/Chrome/.test(e.navigator.userAgent))return!1;try{return t&&typeof t.open=="function"&&typeof e.IDBKeyRange!="undefined"}catch(n){return!1}}(),n[i.LOCALSTORAGE]=!!function(){try{return e.localStorage&&"setItem"in e.localStorage&&e.localStorage.setItem}catch(t){return!1}}(),n}(this),f=Array.isArray||function(e){return Object.prototype.toString.call(e)==="[object Array]"},p=function(){function t(e){r(this,t),this.INDEXEDDB=i.INDEXEDDB,this.LOCALSTORAGE=i.LOCALSTORAGE,this.WEBSQL=i.WEBSQL,this._defaultConfig=c({},u),this._config=c({},this._defaultConfig,e),this._driverSet=null,this._initDriver=null,this._ready=!1,this._dbInfo=null,this._wrapLibraryMethodsWithReady(),this.setDriver(this._config.driver)}return t.prototype.config=function(t){if(typeof t=="object"){if(this._ready)return new Error("Can't call config() after localforage has been used.");for(var n in t)n==="storeName"&&(t[n]=t[n].replace(/\W/g,"_")),this._config[n]=t[n];return"driver"in t&&t.driver&&this.setDriver(this._config.driver),!0}return typeof t=="string"?this._config[t]:this._config},t.prototype.defineDriver=function(n,r,i){var s=new Promise(function(t,r){try{var i=n._driver,s=new Error("Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver"),u=new Error("Custom driver name already in use: "+n._driver);if(!n._driver){r(s);return}if(h(n._driver)){r(u);return}var f=o.concat("_initStorage");for(var l=0;l<f.length;l++){var c=f[l];if(!c||!n[c]||typeof n[c]!="function"){r(s);return}}var p=Promise.resolve(!0);"_support"in n&&(n._support&&typeof n._support=="function"?p=n._support():p=Promise.resolve(!!n._support)),p.then(function(r){a[i]=r,e[i]=n,t()},r)}catch(d){r(d)}});return s.then(r,i),s},t.prototype.driver=function(){return this._driver||null},t.prototype.getDriver=function(r,i,s){var o=this,u=function(){if(h(r))switch(r){case o.INDEXEDDB:return new Promise(function(e,t){e(n(1))});case o.LOCALSTORAGE:return new Promise(function(e,t){e(n(2))});case o.WEBSQL:return new Promise(function(e,t){e(n(4))})}else if(e[r])return Promise.resolve(e[r]);return Promise.reject(new Error("Driver not found."))}();return u.then(i,s),u},t.prototype.getSerializer=function(t){var r=new Promise(function(e,t){e(n(3))});return t&&typeof t=="function"&&r.then(function(e){t(e)}),r},t.prototype.ready=function(t){var n=this,r=n._driverSet.then(function(){return n._ready===null&&(n._ready=n._initDriver()),n._ready});return r.then(t,t),r},t.prototype.setDriver=function(t,n,r){function o(){i._config.driver=i.driver()}function u(e){return function(){function n(){while(t<e.length){var r=e[t];return t++,i._dbInfo=null,i._ready=null,i.getDriver(r).then(function(e){return i._extend(e),o(),i._ready=i._initStorage(i._config),i._ready})["catch"](n)}o();var s=new Error("No available storage method found.");return i._driverSet=Promise.reject(s),i._driverSet}var t=0;return n()}}var i=this;f(t)||(t=[t]);var s=this._getSupportedDrivers(t),a=this._driverSet!==null?this._driverSet["catch"](function(){return Promise.resolve()}):Promise.resolve();return this._driverSet=a.then(function(){var e=s[0];return i._dbInfo=null,i._ready=null,i.getDriver(e).then(function(e){i._driver=e._driver,o(),i._wrapLibraryMethodsWithReady(),i._initDriver=u(s)})})["catch"](function(){o();var e=new Error("No available storage method found.");return i._driverSet=Promise.reject(e),i._driverSet}),this._driverSet.then(n,r),this._driverSet},t.prototype.supports=function(t){return!!a[t]},t.prototype._extend=function(t){c(this,t)},t.prototype._getSupportedDrivers=function(t){var n=[];for(var r=0,i=t.length;r<i;r++){var s=t[r];this.supports(s)&&n.push(s)}return n},t.prototype._wrapLibraryMethodsWithReady=function(){for(var t=0;t<o.length;t++)l(this,o[t])},t.prototype.createInstance=function(n){return new t(n)},t}(),d=new p;t["default"]=d}.call(typeof window!="undefined"?window:self),e.exports=t["default"]},function(e,t){"use strict";t.__esModule=!0,function(){function o(t,n){t=t||[],n=n||{};try{return new Blob(t,n)}catch(r){if(r.name!=="TypeError")throw r;var i=e.BlobBuilder||e.MSBlobBuilder||e.MozBlobBuilder||e.WebKitBlobBuilder,s=new i;for(var o=0;o<t.length;o+=1)s.append(t[o]);return s.getBlob(n.type)}}function u(e){var t=e.length,n=new ArrayBuffer(t),r=new Uint8Array(n);for(var i=0;i<t;i++)r[i]=e.charCodeAt(i);return n}function a(e){return new Promise(function(t,n){var r=new XMLHttpRequest;r.open("GET",e),r.withCredentials=!0,r.responseType="arraybuffer",r.onreadystatechange=function(){if(r.readyState!==4)return;if(r.status===200)return t({response:r.response,type:r.getResponseHeader("Content-Type")});n({status:r.status,response:r.response})},r.send()})}function f(e){return(new Promise(function(t,n){var i=o([""],{type:"image/png"}),s=e.transaction([r],"readwrite");s.objectStore(r).put(i,"key"),s.oncomplete=function(){var i=e.transaction([r],"readwrite"),s=i.objectStore(r).get("key");s.onerror=n,s.onsuccess=function(e){var n=e.target.result,r=URL.createObjectURL(n);a(r).then(function(e){t(!!e&&e.type==="image/png")},function(){t(!1)}).then(function(){URL.revokeObjectURL(r)})}}}))["catch"](function(){return!1})}function l(e){return typeof i=="boolean"?Promise.resolve(i):f(e).then(function(e){return i=e,i})}function c(e){return new Promise(function(t,n){var r=new FileReader;r.onerror=n,r.onloadend=function(n){var r=btoa(n.target.result||"");t({__local_forage_encoded_blob:!0,data:r,type:e.type})},r.readAsBinaryString(e)})}function h(e){var t=u(atob(e.data));return o([t],{type:e.type})}function p(e){return e&&e.__local_forage_encoded_blob}function d(e){function u(){return Promise.resolve()}var t=this,n={db:null};if(e)for(var r in e)n[r]=e[r];s||(s={});var i=s[n.name];i||(i={forages:[],db:null},s[n.name]=i),i.forages.push(this);var o=[];for(var a=0;a<i.forages.length;a++){var f=i.forages[a];f!==this&&o.push(f.ready()["catch"](u))}var l=i.forages.slice(0);return Promise.all(o).then(function(){return n.db=i.db,v(n)}).then(function(e){return n.db=e,y(n,t._defaultConfig.version)?m(n):e}).then(function(e){n.db=i.db=e,t._dbInfo=n;for(var r=0;r<l.length;r++){var s=l[r];s!==t&&(s._dbInfo.db=n.db,s._dbInfo.version=n.version)}})}function v(e){return g(e,!1)}function m(e){return g(e,!0)}function g(t,i){return new Promise(function(s,o){if(t.db){if(!i)return s(t.db);t.db.close()}var u=[t.name];i&&u.push(t.version);var a=n.open.apply(n,u);i&&(a.onupgradeneeded=function(n){var i=a.result;try{i.createObjectStore(t.storeName),n.oldVersion<=1&&i.createObjectStore(r)}catch(s){if(s.name!=="ConstraintError")throw s;e.console.warn('The database "'+t.name+'"'+" has been upgraded from version "+n.oldVersion+" to version "+n.newVersion+', but the storage "'+t.storeName+'" already exists.')}}),a.onerror=function(){o(a.error)},a.onsuccess=function(){s(a.result)}})}function y(t,n){if(!t.db)return!0;var r=!t.db.objectStoreNames.contains(t.storeName),i=t.version<t.db.version,s=t.version>t.db.version;i&&(t.version!==n&&e.console.warn('The database "'+t.name+'"'+" can't be downgraded from version "+t.db.version+" to version "+t.version+"."),t.version=t.db.version);if(s||r){if(r){var o=t.db.version+1;o>t.version&&(t.version=o)}return!0}return!1}function b(t,n){var r=this;typeof t!="string"&&(e.console.warn(t+" used as a key, but it is not a string."),t=String(t));var i=new Promise(function(e,n){r.ready().then(function(){var i=r._dbInfo,s=i.db.transaction(i.storeName,"readonly").objectStore(i.storeName),o=s.get(t);o.onsuccess=function(){var t=o.result;t===undefined&&(t=null),p(t)&&(t=h(t)),e(t)},o.onerror=function(){n(o.error)}})["catch"](n)});return k(i,n),i}function w(e,t){var n=this,r=new Promise(function(t,r){n.ready().then(function(){var i=n._dbInfo,s=i.db.transaction(i.storeName,"readonly").objectStore(i.storeName),o=s.openCursor(),u=1;o.onsuccess=function(){var n=o.result;if(n){var r=n.value;p(r)&&(r=h(r));var i=e(r,n.key,u++);i!==void 0?t(i):n["continue"]()}else t()},o.onerror=function(){r(o.error)}})["catch"](r)});return k(r,t),r}function E(t,n,r){var i=this;typeof t!="string"&&(e.console.warn(t+" used as a key, but it is not a string."),t=String(t));var s=new Promise(function(e,r){var s;i.ready().then(function(){return s=i._dbInfo,n instanceof Blob?l(s.db).then(function(e){return e?n:c(n)}):n}).then(function(n){var i=s.db.transaction(s.storeName,"readwrite"),o=i.objectStore(s.storeName);n===null&&(n=undefined);var u=o.put(n,t);i.oncomplete=function(){n===undefined&&(n=null),e(n)},i.onabort=i.onerror=function(){var e=u.error?u.error:u.transaction.error;r(e)}})["catch"](r)});return k(s,r),s}function S(t,n){var r=this;typeof t!="string"&&(e.console.warn(t+" used as a key, but it is not a string."),t=String(t));var i=new Promise(function(e,n){r.ready().then(function(){var i=r._dbInfo,s=i.db.transaction(i.storeName,"readwrite"),o=s.objectStore(i.storeName),u=o["delete"](t);s.oncomplete=function(){e()},s.onerror=function(){n(u.error)},s.onabort=function(){var e=u.error?u.error:u.transaction.error;n(e)}})["catch"](n)});return k(i,n),i}function x(e){var t=this,n=new Promise(function(e,n){t.ready().then(function(){var r=t._dbInfo,i=r.db.transaction(r.storeName,"readwrite"),s=i.objectStore(r.storeName),o=s.clear();i.oncomplete=function(){e()},i.onabort=i.onerror=function(){var e=o.error?o.error:o.transaction.error;n(e)}})["catch"](n)});return k(n,e),n}function T(e){var t=this,n=new Promise(function(e,n){t.ready().then(function(){var r=t._dbInfo,i=r.db.transaction(r.storeName,"readonly").objectStore(r.storeName),s=i.count();s.onsuccess=function(){e(s.result)},s.onerror=function(){n(s.error)}})["catch"](n)});return k(n,e),n}function N(e,t){var n=this,r=new Promise(function(t,r){if(e<0){t(null);return}n.ready().then(function(){var i=n._dbInfo,s=i.db.transaction(i.storeName,"readonly").objectStore(i.storeName),o=!1,u=s.openCursor();u.onsuccess=function(){var n=u.result;if(!n){t(null);return}e===0?t(n.key):o?t(n.key):(o=!0,n.advance(e))},u.onerror=function(){r(u.error)}})["catch"](r)});return k(r,t),r}function C(e){var t=this,n=new Promise(function(e,n){t.ready().then(function(){var r=t._dbInfo,i=r.db.transaction(r.storeName,"readonly").objectStore(r.storeName),s=i.openCursor(),o=[];s.onsuccess=function(){var t=s.result;if(!t){e(o);return}o.push(t.key),t["continue"]()},s.onerror=function(){n(s.error)}})["catch"](n)});return k(n,e),n}function k(e,t){t&&e.then(function(e){t(null,e)},function(e){t(e)})}var e=this,n=n||this.indexedDB||this.webkitIndexedDB||this.mozIndexedDB||this.OIndexedDB||this.msIndexedDB;if(!n)return;var r="local-forage-detect-blob-support",i,s,L={_driver:"asyncStorage",_initStorage:d,iterate:w,getItem:b,setItem:E,removeItem:S,clear:x,length:T,key:N,keys:C};t["default"]=L}.call(typeof window!="undefined"?window:self),e.exports=t["default"]},function(e,t,n){"use strict";t.__esModule=!0,function(){function s(e){var t=this,r={};if(e)for(var i in e)r[i]=e[i];return r.keyPrefix=r.name+"/",r.storeName!==t._defaultConfig.storeName&&(r.keyPrefix+=r.storeName+"/"),t._dbInfo=r,(new Promise(function(e,t){e(n(3))})).then(function(e){return r.serializer=e,Promise.resolve()})}function o(e){var t=this,n=t.ready().then(function(){var e=t._dbInfo.keyPrefix;for(var n=r.length-1;n>=0;n--){var i=r.key(n);i.indexOf(e)===0&&r.removeItem(i)}});return d(n,e),n}function u(t,n){var i=this;typeof t!="string"&&(e.console.warn(t+" used as a key, but it is not a string."),t=String(t));var s=i.ready().then(function(){var e=i._dbInfo,n=r.getItem(e.keyPrefix+t);return n&&(n=e.serializer.deserialize(n)),n});return d(s,n),s}function a(e,t){var n=this,i=n.ready().then(function(){var t=n._dbInfo,i=t.keyPrefix,s=i.length,o=r.length,u=1;for(var a=0;a<o;a++){var f=r.key(a);if(f.indexOf(i)!==0)continue;var l=r.getItem(f);l&&(l=t.serializer.deserialize(l)),l=e(l,f.substring(s),u++);if(l!==void 0)return l}});return d(i,t),i}function f(e,t){var n=this,i=n.ready().then(function(){var t=n._dbInfo,i;try{i=r.key(e)}catch(s){i=null}return i&&(i=i.substring(t.keyPrefix.length)),i});return d(i,t),i}function l(e){var t=this,n=t.ready().then(function(){var e=t._dbInfo,n=r.length,i=[];for(var s=0;s<n;s++)r.key(s).indexOf(e.keyPrefix)===0&&i.push(r.key(s).substring(e.keyPrefix.length));return i});return d(n,e),n}function c(e){var t=this,n=t.keys().then(function(e){return e.length});return d(n,e),n}function h(t,n){var i=this;typeof t!="string"&&(e.console.warn(t+" used as a key, but it is not a string."),t=String(t));var s=i.ready().then(function(){var e=i._dbInfo;r.removeItem(e.keyPrefix+t)});return d(s,n),s}function p(t,n,i){var s=this;typeof t!="string"&&(e.console.warn(t+" used as a key, but it is not a string."),t=String(t));var o=s.ready().then(function(){n===undefined&&(n=null);var e=n;return new Promise(function(i,o){var u=s._dbInfo;u.serializer.serialize(n,function(n,s){if(s)o(s);else try{r.setItem(u.keyPrefix+t,n),i(e)}catch(a){(a.name==="QuotaExceededError"||a.name==="NS_ERROR_DOM_QUOTA_REACHED")&&o(a),o(a)}})})});return d(o,i),o}function d(e,t){t&&e.then(function(e){t(null,e)},function(e){t(e)})}var e=this,r=null;try{if(!this.localStorage||!("setItem"in this.localStorage))return;r=this.localStorage}catch(i){return}var v={_driver:"localStorageWrapper",_initStorage:s,iterate:a,getItem:u,setItem:p,removeItem:h,clear:o,length:c,key:f,keys:l};t["default"]=v}.call(typeof window!="undefined"?window:self),e.exports=t["default"]},function(e,t){"use strict";t.__esModule=!0,function(){function b(e,t){e=e||[],t=t||{};try{return new Blob(e,t)}catch(n){if(n.name!=="TypeError")throw n;var r=y.BlobBuilder||y.MSBlobBuilder||y.MozBlobBuilder||y.WebKitBlobBuilder,i=new r;for(var s=0;s<e.length;s+=1)i.append(e[s]);return i.getBlob(t.type)}}function w(e,t){var r="";e&&(r=e.toString());if(e&&(e.toString()==="[object ArrayBuffer]"||e.buffer&&e.buffer.toString()==="[object ArrayBuffer]")){var s,g=i;e instanceof ArrayBuffer?(s=e,g+=o):(s=e.buffer,r==="[object Int8Array]"?g+=a:r==="[object Uint8Array]"?g+=f:r==="[object Uint8ClampedArray]"?g+=l:r==="[object Int16Array]"?g+=c:r==="[object Uint16Array]"?g+=p:r==="[object Int32Array]"?g+=h:r==="[object Uint32Array]"?g+=d:r==="[object Float32Array]"?g+=v:r==="[object Float64Array]"?g+=m:t(new Error("Failed to get type for BinaryArray"))),t(g+x(s))}else if(r==="[object Blob]"){var y=new FileReader;y.onload=function(){var r=n+e.type+"~"+x(this.result);t(i+u+r)},y.readAsArrayBuffer(e)}else try{t(JSON.stringify(e))}catch(b){console.error("Couldn't convert value into a JSON string: ",e),t(null,b)}}function E(e){if(e.substring(0,s)!==i)return JSON.parse(e);var t=e.substring(g),n=e.substring(s,g),y;if(n===u&&r.test(t)){var w=t.match(r);y=w[1],t=t.substring(w[0].length)}var E=S(t);switch(n){case o:return E;case u:return b([E],{type:y});case a:return new Int8Array(E);case f:return new Uint8Array(E);case l:return new Uint8ClampedArray(E);case c:return new Int16Array(E);case p:return new Uint16Array(E);case h:return new Int32Array(E);case d:return new Uint32Array(E);case v:return new Float32Array(E);case m:return new Float64Array(E);default:throw new Error("Unkown type: "+n)}}function S(t){var n=t.length*.75,r=t.length,i,s=0,o,u,a,f;t[t.length-1]==="="&&(n--,t[t.length-2]==="="&&n--);var l=new ArrayBuffer(n),c=new Uint8Array(l);for(i=0;i<r;i+=4)o=e.indexOf(t[i]),u=e.indexOf(t[i+1]),a=e.indexOf(t[i+2]),f=e.indexOf(t[i+3]),c[s++]=o<<2|u>>4,c[s++]=(u&15)<<4|a>>2,c[s++]=(a&3)<<6|f&63;return l}function x(t){var n=new Uint8Array(t),r="",i;for(i=0;i<n.length;i+=3)r+=e[n[i]>>2],r+=e[(n[i]&3)<<4|n[i+1]>>4],r+=e[(n[i+1]&15)<<2|n[i+2]>>6],r+=e[n[i+2]&63];return n.length%3===2?r=r.substring(0,r.length-1)+"=":n.length%3===1&&(r=r.substring(0,r.length-2)+"=="),r}var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",n="~~local_forage_type~",r=/^~~local_forage_type~([^~]+)~/,i="__lfsc__:",s=i.length,o="arbf",u="blob",a="si08",f="ui08",l="uic8",c="si16",h="si32",p="ur16",d="ui32",v="fl32",m="fl64",g=s+o.length,y=this,T={serialize:w,deserialize:E,stringToBuffer:S,bufferToString:x};t["default"]=T}.call(typeof window!="undefined"?window:self),e.exports=t["default"]},function(e,t,n){"use strict";t.__esModule=!0,function(){function i(e){var t=this,i={db:null};if(e)for(var s in e)i[s]=typeof e[s]!="string"?e[s].toString():e[s];var o=new Promise(function(n,s){try{i.db=r(i.name,String(i.version),i.description,i.size)}catch(o){return t.setDriver(t.LOCALSTORAGE).then(function(){return t._initStorage(e)}).then(n)["catch"](s)}i.db.transaction(function(e){e.executeSql("CREATE TABLE IF NOT EXISTS "+i.storeName+" (id INTEGER PRIMARY KEY, key unique, value)",[],function(){t._dbInfo=i,n()},function(e,t){s(t)})})});return(new Promise(function(e,t){e(n(3))})).then(function(e){return i.serializer=e,o})}function s(t,n){var r=this;typeof t!="string"&&(e.console.warn(t+" used as a key, but it is not a string."),t=String(t));var i=new Promise(function(e,n){r.ready().then(function(){var i=r._dbInfo;i.db.transaction(function(r){r.executeSql("SELECT * FROM "+i.storeName+" WHERE key = ? LIMIT 1",[t],function(t,n){var r=n.rows.length?n.rows.item(0).value:null;r&&(r=i.serializer.deserialize(r)),e(r)},function(e,t){n(t)})})})["catch"](n)});return p(i,n),i}function o(e,t){var n=this,r=new Promise(function(t,r){n.ready().then(function(){var i=n._dbInfo;i.db.transaction(function(n){n.executeSql("SELECT * FROM "+i.storeName,[],function(n,r){var s=r.rows,o=s.length;for(var u=0;u<o;u++){var a=s.item(u),f=a.value;f&&(f=i.serializer.deserialize(f)),f=e(f,a.key,u+1);if(f!==void 0){t(f);return}}t()},function(e,t){r(t)})})})["catch"](r)});return p(r,t),r}function u(t,n,r){var i=this;typeof t!="string"&&(e.console.warn(t+" used as a key, but it is not a string."),t=String(t));var s=new Promise(function(e,r){i.ready().then(function(){n===undefined&&(n=null);var s=n,o=i._dbInfo;o.serializer.serialize(n,function(n,i){i?r(i):o.db.transaction(function(i){i.executeSql("INSERT OR REPLACE INTO "+o.storeName+" (key, value) VALUES (?, ?)",[t,n],function(){e(s)},function(e,t){r(t)})},function(e){e.code===e.QUOTA_ERR&&r(e)})})})["catch"](r)});return p(s,r),s}function a(t,n){var r=this;typeof t!="string"&&(e.console.warn(t+" used as a key, but it is not a string."),t=String(t));var i=new Promise(function(e,n){r.ready().then(function(){var i=r._dbInfo;i.db.transaction(function(r){r.executeSql("DELETE FROM "+i.storeName+" WHERE key = ?",[t],function(){e()},function(e,t){n(t)})})})["catch"](n)});return p(i,n),i}function f(e){var t=this,n=new Promise(function(e,n){t.ready().then(function(){var r=t._dbInfo;r.db.transaction(function(t){t.executeSql("DELETE FROM "+r.storeName,[],function(){e()},function(e,t){n(t)})})})["catch"](n)});return p(n,e),n}function l(e){var t=this,n=new Promise(function(e,n){t.ready().then(function(){var r=t._dbInfo;r.db.transaction(function(t){t.executeSql("SELECT COUNT(key) as c FROM "+r.storeName,[],function(t,n){var r=n.rows.item(0).c;e(r)},function(e,t){n(t)})})})["catch"](n)});return p(n,e),n}function c(e,t){var n=this,r=new Promise(function(t,r){n.ready().then(function(){var i=n._dbInfo;i.db.transaction(function(n){n.executeSql("SELECT key FROM "+i.storeName+" WHERE id = ? LIMIT 1",[e+1],function(e,n){var r=n.rows.length?n.rows.item(0).key:null;t(r)},function(e,t){r(t)})})})["catch"](r)});return p(r,t),r}function h(e){var t=this,n=new Promise(function(e,n){t.ready().then(function(){var r=t._dbInfo;r.db.transaction(function(t){t.executeSql("SELECT key FROM "+r.storeName,[],function(t,n){var r=[];for(var i=0;i<n.rows.length;i++)r.push(n.rows.item(i).key);e(r)},function(e,t){n(t)})})})["catch"](n)});return p(n,e),n}function p(e,t){t&&e.then(function(e){t(null,e)},function(e){t(e)})}var e=this,r=this.openDatabase;if(!r)return;var d={_driver:"webSQLStorage",_initStorage:i,iterate:o,getItem:s,setItem:u,removeItem:a,clear:f,length:l,key:c,keys:h};t["default"]=d}.call(typeof window!="undefined"?window:self),e.exports=t["default"]}])}),define("models/localisationmodel",["config","util/dom","util/object","util/string","util/addpublishers","lib/reqwest","lib/localforage.nopromises"],function(e,t,n,r,i,s,o){function u(){function y(t){t!==h&&e.settings.language.options.indexOf(t)!==-1&&S(t)}function b(e,t){e==="language"&&t!==h&&y(t)}function w(t){t.origin===e.origin&&t.data.language&&(d=!0,c=t.data.language,k(),C(t.data.language))}function E(e,t,n){if(!(e&&t&&n)){var r=A(arguments,1);return L(e,A(arguments,1))}l.push({el:e,attribute:t,key:n,wasUpdated:!1,args:A(arguments)}),C()}function S(t){d=!1,s({url:e.language.dir+"/"+t+".json",type:"json",method:"get",error:function(e){d=!0,f.error.dispatch("I'm really sorry. I failed to load the language file for "+t+". This is a serious error that makes the app very hard to use. Maybe you can try reloading?")},success:function(e){T(e.lang.toLowerCase(),e)}})}function x(){o.getItem(e.keys.language,function(e,t){e||t&&t.lang&&T(t.lang,t)})}function T(t,n){h=t,d=!0,c=n,N(n),k(),C(),e.language.debug&&(postMessage({availableLanguages:e.settings.language.options},e.origin),postMessage({loaded:!0},e.origin))}function N(t){o.setItem(e.keys.language,t)}function C(e){d&&(cancelAnimationFrame(p),p=requestAnimationFrame(function(){var n,i;for(var s=l.length-1;s>=0;s--)n=l[s],t.isElement(n.el)?n.wasUpdated||(n.attribute==="innerHTML"?n.el.innerHTML=r.markdownToHtml(L(n.key,n.args,e),v):n.el[n.attribute]=L(n.key,n.args,e),n.wasUpdated=!0):l.splice(s,1);f.update.dispatch()}))}function k(){l.forEach(function(e){e.wasUpdated=!1})}function L(e,t,r){var i="";r=r||c;try{i=n.getObjectByString(e,r)}catch(s){d&&(i=e)}Array.isArray(i)&&(i=i.join("\n\n"));if(t&&t.length){var o;t.forEach(function(e,t){o=new RegExp("{\\$"+(t+1)+"}"),typeof e=="string"?i=i.replace(o,e):typeof e=="function"&&(i=i.replace(o,e()))})}return i}function A(e,t){t=t||3;var n;e.length>t&&(n=[]);for(var r=t,i=e.length;r<i;r++)n[n.length]=e[r];return n}if(!(this instanceof u))return new u;var a=this,f=i(a,"update","newlanguage","error"),l=[],c="",h="",p=NaN,d=!1,v={links:{newTab:!0}},m=(navigator.language||navigator.userLanguage||"").toLowerCase();if(m!==""){var g=!1;e.settings.language.options.indexOf(m)>-1?(e.settings.language.value=m,g=!0):e.settings.language.options.forEach(function(t){m.substr(0,2)===t.substr(0,2)&&(e.settings.language.value=t,g=!0)}),g||setTimeout(f.newlanguage.dispatch,100,m)}x(),e.language.debug&&addEventListener("message",w,!1),a.setLanguage=y,a.localizeText=E,a.settingUpdated=b}return u.sharedInstance=u(),u}),define("util/localizetext",["models/localisationmodel"],function(e){function t(){return e.sharedInstance.localizeText.apply(e.sharedInstance,arguments)}return t}),define("util/el",["util/dom","util/localizetext"],function(e,t){function i(e,t,i){var s=n.indexOf(e)!==-1,o=s?document.createElementNS(r,e):document.createElement(e);return s&&document.createElementNS("http://www.w3.org/2000/svg","rect"),t=typeof t=="string"?[].concat(t.split(" ")):t,Array.isArray(t)&&t.forEach(function(e){o.classList.add(e)}),i&&i.appendChild&&i.appendChild(o),o}function s(n,r,s,o,u){var a=i("button",s,o);return typeof n=="string"?t(a,"textContent",n):e.isElement(n)&&a.appendChild(n),t(a,"title",r),typeof u=="function"&&a.addEventListener("click",u),a}function o(n,r,s,o,u,a){var f=i("a",u,a);return typeof n=="string"?t(f,"textContent",n):e.isElement(n)&&f.appendChild(n),r&&t(f,"title",r),s&&(f.href=s),o&&(f.target=o),f}function u(n,r,s,o){var u=i("label",s,o);return typeof n=="string"?t(u,"textContent",n):e.isElement(n)&&u.appendChild(n),r&&u.setAttribute("for",r),u}var n=["g","svg","rect"],r="http://www.w3.org/2000/svg";return{createEl:i,createButton:s,createLink:o,createLabel:u}}),define("views/appview",["util/el","util/localizetext"],function(e,t){function n(r){function o(){return document.documentElement.classList.add("is-online"),i}function u(){return document.documentElement.classList.remove("is-online"),i}if(!(this instanceof n))return new n(r);var i=this,s=e.createEl("div","app",r);t(document.title,"textContent","index.title"),t(document.documentElement,"lang","lang"),i.el=s,i.showOnlineOptions=o,i.hideOnlineOptions=u}return n}),define("views/dialog",["util/el","util/dom","util/addpublishers"],function(e,t,n){function i(){r.forEach(function(e){e.hide()})}function s(o,u,a){function v(){return c||(i(),d.classList.add("is-visible"),c=!0,l.show.dispatch(),clearTimeout(h),h=setTimeout(function(){d.classList.add("is-active"),p&&a.classList.add("is-active")},10)),f}function m(){return c&&(d.classList.remove("is-active"),c=!1,l.hide.dispatch(),p&&a.classList.remove("is-active"),clearTimeout(h),h=setTimeout(function(){d.classList.remove("is-visible")},500)),f}function g(){return c?m():v(),f}function y(){var e=document.createElement("div");e.classList.add("dialog-item"),d.appendChild(e);for(var t=0,n=arguments.length;t<n;t++)typeof arguments[t]=="string"?arguments[t].split(" ").forEach(function(t){e.classList.add(t)}):(arguments[t].wrapperEl=e,e.appendChild(arguments[t]));return f}function b(e){return e.parentNode.parentNode.removeChild(e.parentNode),f}if(!(this instanceof s))return new s(o,u,a);var f=this,l=n(f,"hide show"),c=!1,h=NaN,p=!1,d=e.createEl("div","dialog color-bg-light "+o,u);a&&t.isElement(a)&&(p=!0,a.addEventListener("click",g)),f.add=y,f.remove=b,f.show=v,f.hide=m,f.toggle=g,f.el=d,r.push(f)}var r=[];return s.closeAll=i,s}),define("util/math",[],function(){function e(e,t,n,r,i,s){var o=(e-t)/(n-t)*(i-r)+r;return s&&(r>i?o=Math.min(Math.max(o,i),r):o=Math.min(Math.max(o,r),i)),o}return{mapRange:e}}),define("views/navview",["util/el","util/dom","views/dialog","util/addpublishers","util/math","util/localizetext"],function(e,t,n,r,i,s){function o(u){function _(){a?P():D()}function D(){a=!0,requestAnimationFrame(function(){l.classList.add("is-active"),b.classList.add("is-active")}),c.togglestart.dispatch(!0),setTimeout(function(){c.toggleend.dispatch(!0)},300)}function P(){a=!1,n.closeAll(),requestAnimationFrame(function(){l.classList.remove("is-active"),b.classList.remove("is-active")}),c.togglestart.dispatch(!1),setTimeout(function(){c.toggleend.dispatch(!1)},300)}function H(){window.innerWidth<=E&&P()}function B(e,t,n){T||(u.addEventListener("touchmove",q),u.addEventListener("touchend",R),T=!0,touchIdentifier=n,N.x=e,N.y=t,C.x=e,C.y=t,requestAnimationFrame(function(){l.classList.add("is-swiping"),b.classList.add("is-swiping")}))}function j(){if(T){u.removeEventListener("touchmove",q),u.addEventListener("touchend",R),T=!1,requestAnimationFrame(function(){l.classList.remove("is-swiping"),b.classList.remove("is-swiping"),t.setTransform(l,""),t.setTransform(b,""),t.setTransform(m,""),t.setTransform(g,""),t.setTransform(y,""),t.setTransform(v,""),v.style.fill="",h.style.width="",h.style.opacity=""});var e=C.x-N.x;L>-S&&L<0&&Math.abs(e)>0&&(L<-S/2?P():D())}}function F(e,n,r){C.x=e,C.y=n;var s=C.x-N.x,o=!1;a?s<0&&s>=-S?(o=!0,L=Math.round(Math.max(s,-S))):j():s>0&&s<=S?(o=!0,L=-S+Math.round(Math.min(s,S))):j(),o&&requestAnimationFrame(function(){t.setTransform(l,"translateX("+L+"px)");var e="translateX("+i.mapRange(L,-S,0,0,242)+"px)";t.setTransform(b,e);var n=["rotateZ("+i.mapRange(L,-S,0,0,45)+"deg)","translateY("+i.mapRange(L,-S,0,0,5.1)+"px)"].join(" ");t.setTransform(m,n),t.setTransform(g,"scaleX("+i.mapRange(L,-S,0,1,0)+")");var r=["rotateZ("+i.mapRange(L,-S,0,0,-45)+"deg)","translateY("+i.mapRange(L,-S,0,0,-5.1)+"px)"].join(" ");t.setTransform(y,r),t.setTransform(v,"rotateZ("+i.mapRange(L,-S,0,0,-90)+"deg)"),v.style.fill="hsl(0, 0%, "+i.mapRange(L,-S,0,0,100)+"%)",h.style.width=i.mapRange(L,-S,0,50,0)+"px",h.style.opacity=i.mapRange(L,-S,0,1.5,0,!0).toFixed(2)})}function I(e){if(window.innerWidth<=E&&!T)for(A=0,O=e.touches.length;A<O;A++){M=e.touches[A];if(!a&&M.clientX<=x||a&&M.clientX<=x+S){B(M.clientX,M.clientY,M.identifier);break}}}function q(e){if(e.changedTouches){var t=!1;for(A=0,O=e.touches.length;A<O;A++){M=e.touches[A];if(M.identifier===touchIdentifier){F(M.clientX,M.clientY,M.identifier),t=!0;break}}t||j()}else j()}function R(e){j()}if(!(this instanceof o))return new o(u);var a=!1,f=this,l=e.createEl("nav","nav color-bg",u),c=r(f,"togglestart","toggleend"),h=e.createEl("span","nav-toggle-button-text");s(h,"textContent","nav.menu"),s(h,"title","nav.menutitle");var p=document.createElement("div");p.classList.add("svg-wrapper");var d=document.getElementById("svg");d.setAttribute("viewBox","0 0 24 24"),p.appendChild(d);var v=document.createElementNS("http://www.w3.org/2000/svg","g");v.setAttribute("id","menu"),v.setAttributeNS(null,"fill","#000"),d.appendChild(v);var m=e.createEl("rect",null,v);m.setAttribute("id","rect-1"),m.setAttributeNS(null,"x","3"),m.setAttributeNS(null,"y","6"),m.setAttributeNS(null,"width","18"),m.setAttributeNS(null,"height","2");var g=e.createEl("rect",null,v);g.setAttributeNS(null,"id","rect-2"),g.setAttributeNS(null,"x","3"),g.setAttributeNS(null,"y","11"),g.setAttributeNS(null,"width","18"),g.setAttributeNS(null,"height","2");var y=e.createEl("rect",null,v);y.setAttributeNS(null,"id","rect-3"),y.setAttributeNS(null,"x","3"),y.setAttributeNS(null,"y","16"),y.setAttributeNS(null,"width","18"),y.setAttributeNS(null,"height","2"),p.appendChild(d);var b=e.createButton(h,"nav.menutitle","nav-toggle-button",u);b.appendChild(p),b.addEventListener("click",_,!1);var w=e.createEl("h1","nav-headline",l);s(w,"textContent","index.title");var E=600,S=300,x=60,T=!1,N={x:0,y:0},C={x:0,y:0},k=0,L=-S,A=0,O=0,M;u.addEventListener("touchstart",I),f.el=l,f.closeSmallScreenNav=H}return o}),define("views/controlsview",["util/addpublishers","util/el","util/localizetext"],function(e,t,n){function r(i,s,o){function y(){var e=N();for(var t in e)a.update.dispatch(t,e[t])}function b(e,r){var i=t.createEl("div","control",v),s=t.createLabel("controls."+e,"input-"+e,"control-label",i);n(s,"title","controls."+e);var o=t.createEl("input","control-input",i);o.setAttribute("data-key",e),o.setAttribute("id","input-"+e),o.type="range",o.value=r.value||0,o.min=r.min||0,o.max=r.max||100,o.addEventListener("input",w),o.addEventListener("change",w),h[e]=o;var u=t.createEl("input","control-value",i);u.setAttribute("data-key",e),u.type="number",u.value=r.value||0,u.min=r.min||0,u.max=r.max||100,u.addEventListener("input",w),u.addEventListener("change",w),p[e]=u,w({target:o})}function w(e){if(l&&!f){var t=e.target.getAttribute("data-key"),n=N();n[t]!==e.target.value&&(n[t]=parseInt(e.target.value,10),a.update.dispatch(t,n[t]))}}function E(e){l&&a.random.dispatch()}function S(){l?x():T()}function x(){d.classList.remove("is-active"),m.classList.remove("is-active"),s.classList.remove("controls-enabled"),l=!1,clearTimeout(c),c=setTimeout(function(){d.classList.remove("is-visible")},500)}function T(){d.classList.add("is-visible"),l=!0,clearTimeout(c),c=setTimeout(function(){d.classList.add("is-active"),m.classList.add("is-active"),s.classList.add("controls-enabled")},10)}function N(){var e={};for(var t in h)e[t]=parseInt(h[t].value,10);return e}function C(e,t){f=!0,h[e].value=t,p[e].value=t,f=!1}if(!(this instanceof r))return new r(i,s,o);o=o||{};var u=this,a=e(u,"update","random"),f=!1,l=!0,c=0,h={},p={},d=t.createEl("div","controls",i),v=t.createEl("div","controls-wrapper",d),m=t.createButton("controls.controls","controls.controlstitle","controls-toggle-button button is-active",s,S);for(var g in o)b(g,o[g]);T(),t.createButton("controls.randomize","controls.randomizetitle","random-button button",v,E),u.loadInitialValues=y,u.setValue=C}return r}),define("util/time",[],function(){function n(e){return e.toISOString()}function r(e){return new Date(parseInt(e,10))}function i(n){return t&&Intl.DateTimeFormat.supportedLocalesOf([e]).length&&n.toLocaleDateString&&n.toLocaleTimeString?n.toLocaleDateString(e)+" "+n.toLocaleTimeString(e):s(n)+" "+o(n)}function s(n){return t&&Intl.DateTimeFormat.supportedLocalesOf([e]).length&&n.toLocaleDateString?n.toLocaleDateString(e):navigator.language.toLowerCase()==="en-us"?n.getMonth()+1+"/"+n.getDate()+"/"+n.getFullYear():n.getDate()+"."+n.getMonth()+1+"."+n.getFullYear()}function o(n){if(t&&Intl.DateTimeFormat.supportedLocalesOf([e]).length&&n.toLocaleTimeString)return n.toLocaleTimeString(e);var r=n.getHours(),i=n.getMinutes();r<10&&(r="0"+r),i<10&&(i="0"+i);if(navigator.language.toLowerCase().indexOf("en")>=0){var s="AM";return r>12&&(r-=12,s="PM"),r+":"+i+" "+s}return r+":"+i}var e=navigator.language||navigator.userLanguage||"en-us",t=!!window.Intl;return{dateToStr:n,dateToLocalStr:s,timeToLocalStr:o,dateTimeToLocalStr:i,timestampToDate:r}}),define("views/openfileview",["util/browser","util/addpublishers","util/el","util/time","util/localizetext","views/dialog"],function(e,t,n,r,i,s){function o(u){function y(e){e.target&&e.target.files&&e.target.files[0]&&d.openfile.dispatch(e.target.files[0])}function b(e){if(l)if(e&&Object.keys(e).length){c&&(x(c),c=null);var t,r;for(var s in e)t=l.querySelector('[data-uid="'+s+'"]'),w(t,s,e[s]);var o=l.querySelectorAll("[data-uid]");for(var u=0,f=o.length;u<f;u++){var h=o[u].getAttribute("data-uid");h&&!e[h]&&x(o[u])}}else{if(e&&Object.keys(e).length===0){var o=l.querySelectorAll("[data-uid]");for(var u=0,f=o.length;u<f;u++)x(o[u])}c||(c=n.createEl("li","no-items"),i(c,"textContent","file.norecent"),l.appendChild(c))}return a}function w(e,t,n){if(n.src&&n.values&&!e)E(t,n);else if(e)if(!n.src&&!n.values)x(e);else{var r=e.querySelector(".entry-shared-button-wrapper");!n.deleteHash&&r&&(r.parentNode.removeChild(r),e.classList.remove("has-offline-button")),n.deleteHash&&!r&&S(e,n.deleteHash,n.publicUrl,t)}}function E(e,t){if(t){var s=r.timestampToDate(t.timestamp),o=n.createEl("li","entry clear dialog-list-item",l);o.setAttribute("data-uid",e);var u=n.createEl("img","entry-thumb",o);u.src=t.thumbnail,u.addEventListener("click",C(e));var a=n.createEl("p","entry-text",o),f=n.createEl("p","entry-name",a);t.name?f.textContent=t.name:i(f,"textContent","file.untitled");var c=n.createEl("time","entry-datetime",a);c.setAttribute("datetime",s.toISOString());var h=n.createEl("span","entry-date",c);h.textContent=r.dateToLocalStr(s);var p=n.createEl("span","entry-time",c);p.textContent=r.timeToLocalStr(s);var d=n.createEl("div","entry-button-wrapper",o);n.createButton("file.del","file.deltitle","item-delete-button button",d,T(e)),n.createButton("file.openimage","file.openimagetitle","item-load-button button",d,C(e)),t.deleteHash&&t.publicUrl&&S(o,t.deleteHash,t.publicUrl,e)}}function S(e,t,r,i){var s=n.createEl("div","entry-shared-button-wrapper is-online-only",e);e.classList.add("has-offline-button"),n.createButton("file.offline","file.offlinetitle","item-offline-button button",s,N(i,t)),n.createLink("file.openlink","file.openlinktitle",r,"_blank","entry-shared-link button",s)}function x(e){e.parentNode.removeChild(e)}function T(e){return function(){d.deletefromlocalstorage.dispatch(e)}}function N(e,t){return function(){var n=l.querySelector('[data-uid="'+e+'"] .item-offline-button');n&&n.setAttribute("disabled","disabled"),d.deletefromimgur.dispatch(e,t)}}function C(e){return function(){p.hide(),d.openfromlocalstorage.dispatch(e)}}if(!(this instanceof o))return new o(u);var a=this,f,l,c,h,p,d=t(a,"openfile","deletefromlocalstorage","openfromlocalstorage","deletefromimgur");if(e.getFeature(window,"FileReader")){h=n.createButton("file.open","file.opentitle","open-button nav-button",u),p=s("open-file-dialog",u,h);var v=n.createLabel("file.importtitle","input-file","file-label label");fileInputEl=document.createElement("input"),fileInputEl.classList.add("file-input"),fileInputEl.type="file",fileInputEl.id="input-file",fileInputEl.accept="image/*",fileInputEl.addEventListener("change",y);var m=n.createLabel("file.import","input-file","file-button button");p.add(v,fileInputEl,m),a.fileinput=fileInputEl}if(e.test("localforage")){l=n.createEl("ul","storage-list dialog-list");var g=n.createLabel("file.recent","file.recenttitle","load-label label");p.add(g,l)}a.updateList=b,a.dialog=p}return o}),define("views/fullscreenview",["util/browser","util/el"],function(e,t){function n(r){function u(e){s=document.fullscreen||document.mozFullScreen||document.webkitIsFullScreen,s?document.documentElement.classList.add("is-fullscreen"):document.documentElement.classList.remove("is-fullscreen")}function a(){s?l():f(document.documentElement)}function f(e){e.requestFullscreen?e.requestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.msRequestFullscreen&&e.msRequestFullscreen()}function l(){document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen()}if(!(this instanceof n))return new n(r);var i=this,s=!1,o;e.test("fullscreen")&&(o=t.createButton("controls.fullscreen","controls.fullscreentitle","fullscreen-button",r,a),document.addEventListener("webkitfullscreenchange",u,!1),document.addEventListener("mozfullscreenchange",u,!1),document.addEventListener("fullscreenchange",u,!1),document.addEventListener("MSFullscreenChange",u,!1))}return n}),define("util/mediastream",[],function(){var e=window.MediaStream;typeof e=="undefined"&&typeof webkitMediaStream!="undefined"&&(e=webkitMediaStream),typeof e!="undefined"&&!("stop"in e.prototype)&&(e.prototype.stop=function(){this.getAudioTracks().forEach(function(e){e.stop()}),this.getVideoTracks().forEach(function(e){e.stop()})})}),define("views/webcamview",["util/browser","util/addpublishers","util/el","util/dom","views/dialog","util/mediastream"],function(e,t,n,r,i){function s(o){function E(e){a||navigator.getUserMedia(p,x,T)}function S(e){b.classList.add("is-taking-picture"),setTimeout(function(){v.video.dispatch(l),b.classList.remove("is-taking-picture")},50)}function x(e){var t=!0;l.mozSrcObject!==undefined?l.mozSrcObject=e:window.URL?l.src=window.URL.createObjectURL(e):t=!1,t?(m.show(),l.play(),k(),a=!0,h=e):(m.hide(),v.error.dispatch("webcam.error.access"))}function T(){h&&(C(),v.error.dispatch("webcam.error.access"))}function N(){m.hide(),C()}function C(){h&&(l.pause(),l.mozSrcObject&&(l.mozSrcObject=null),l.src&&(l.src=null,l.src=""),h.stop&&h.stop(),h=null,a=!1)}function k(){l.videoHeight>0?(l.width=l.videoWidth,l.height=l.videoHeight):setTimeout(k,100)}if(!(this instanceof s))return new s(o);var u=this,a=!1,f,l,c,h,p={video:!0},d,v=t(u,"video","error"),m;if(e.test("getusermedia")){var g=n.createButton("webcam.webcam","webcam.webcamtitle","nav-button photo-button",o),y=n.createLabel("webcam.webcamlabel",null,"webcam-label label"),b=n.createEl("div","video-wrapper"),l=document.createElement("video");l.classList.add("cam-video"),l.controls=!1,r.setTransform(l,"scale(-1, 1)"),l.addEventListener("click",S),b.appendChild(l);var w=n.createButton("webcam.trigger","webcam.triggertitle","cam-trigger-button button",null,S);m=i("webcam-dialog",o,g).add(y,b,w).on("show",E).on("hide",N)}}return s}),define("util/css",[],function(){function e(e){var t=window.getComputedStyle(e);return t.getPropertyValue("-webkit-transform")||t.getPropertyValue("-moz-transform")||t.getPropertyValue("-ms-transform")||t.getPropertyValue("-o-transform")||t.getPropertyValue("transform")}function t(e){e==="none"&&(e="matrix(0,0,0,0,0)");var t={},n=e.match(/([-+]?[\d\.]+)/g);return t.rotate=(Math.round(Math.atan2(parseFloat(n[1]),parseFloat(n[0]))*(180/Math.PI))||0).toString()+"deg",t.translateStr=n[5]?n[4]+"px, "+n[5]+"px":n[4]?n[4]+"px":"",t.translateX=parseFloat(n[4]),t.translateY=n[5]?parseFloat(n[5]):0,t}return{getCSSMatrix:e,cssMatrixToTransformObj:t}}),define("views/panzoom",["util/css","util/dom","util/addpublishers"],function(e,t,n){function r(e){return{x:e.pageX,y:e.pageY}}function i(e,t){var n=Math.abs(t.x-e.x),r=Math.abs(t.y-e.y);return Math.sqrt(n*n+r*r)}function s(e,t){return{x:(e.x+t.x)/2,y:(e.y+t.y)/2}}function o(e){return e.touches?Array.prototype.map.call(e.touches,r):[r(e)]}function u(r,a,f){function M(){_(g.translateX||0,g.translateY||0,1)}function _(e,t,n,i){cancelAnimationFrame(T);if(d&&a!==r&&x){i=i||a.getBoundingClientRect();if(e!==y||t!==b||n!==w){var s=1/(w/n);e+i.width*s<v&&(e=v-i.width*s),e>x.width-v&&(e=x.width-v),t+i.height*s<v&&(t=v-i.height*s),t>x.height-v&&(t=x.height-v)}}n=Math.min(5,Math.max(.01,n));if(w===n&&n===5)return;y=e,b=t,w=n,h.scale.dispatch(w),T=requestAnimationFrame(D)}function D(){a.style.WebkitTransform=a.style.transform="translate3d("+y+"px, "+b+"px, 0) scale("+w+")"}function P(e){if(!p(e.target))return;if(!c)return;e.preventDefault();var t=a.getBoundingClientRect(),n=e.deltaY;e.deltaMode===1&&(n*=15),n=Math.max(Math.min(n,60),-60);var r=n/300+1;if(w*r<.05)return;_(y-(e.pageX-t.left)*(r-1),b-(e.pageY-t.top)*(r-1),w*r,t)}function H(e){document.addEventListener("mousemove",j),document.addEventListener("mouseup",F),document.addEventListener("touchmove",j),document.addEventListener("touchend",F)}function B(e){if(e.type=="mousedown"&&e.which!=1)return;if(!p(e.target))return;t.isDescendant(r,e.target)&&(e.preventDefault(),S=o(e),E++,E===1&&H(e))}function j(e){if(e&&e.target&&t.isDescendant(r,e.target)){e.preventDefault();var n=o(e),u=n.reduce(s),f=S.reduce(s),l=a.getBoundingClientRect(),h=y+u.x-f.x,p=b+u.y-f.y;if(n[1]){if(!c)return;var d=i(n[0],n[1])/i(S[0],S[1]);_(h-(u.x-l.left)*(d-1),p-(u.y-l.top)*(d-1),w*d,l)}else _(h,p,w);S=n}}function F(e){e.preventDefault(),E--,S.pop();if(E){S=o(e);return}document.removeEventListener("mousemove",j),document.removeEventListener("mouseup",F),document.removeEventListener("touchmove",j),document.removeEventListener("touchend",F)}function I(){A={width:r.clientWidth,height:r.clientHeight},L={width:a.clientWidth,height:a.clientHeight},x=r.getBoundingClientRect(),_(y,b,w)}function q(){clearTimeout(k),k=setTimeout(function(){I(),Math.abs(w-O)<=.01&&U()},100)}function R(){var e=X();return _(e.x,e.y,e.scale),l}function U(){function s(){e=i.x-y,t=i.y-b,n=i.scale-w,Math.abs(e)>1||Math.abs(t)>1||Math.abs(n)>.01?(_(y+e*r,b+t*r,w+n*r),C=requestAnimationFrame(s)):_(i.x,i.y,i.scale)}var e=0,t=0,n=0,r=.1,i=X();return O=i.scale,cancelAnimationFrame(N),cancelAnimationFrame(C),C=requestAnimationFrame(s),l}function z(e,t){e==="canZoomWithPointer"&&typeof t=="boolean"&&(c=t)}function W(e){function u(){r=t-y,i=n-b,s=e-w,Math.abs(r)>1||Math.abs(i)>1||Math.abs(s)>.01?(_(y+r*o,b+i*o,w+s*o),N=requestAnimationFrame(u)):_(t,n,e)}var t=(A.width-L.width*e)/2,n=(A.height-L.height*e)/2,r=0,i=0,s=0,o=.2;return cancelAnimationFrame(N),cancelAnimationFrame(C),u(),l}function X(){I();var e=1;if(L.width>A.width||L.height>A.height)e=Math.min(A.width/L.width,(A.height-80)/L.height);return{x:(A.width-L.width*e)/2,y:(A.height-L.height*e)/2,scale:e}}if(!(this instanceof u))return new u(a,r,f);var l=this,c=!0,h=n(l,"scale");f=f||{};var p=f.shouldCaptureFn||function(e){return!0},d=typeof f.limitToContainer=="boolean"?f.limitToContainer:!0,v=f.limitPadding||50,m=e.getCSSMatrix(a),g=e.cssMatrixToTransformObj(m),y=g.translateX||0,b=g.translateY||0,w=1,E=0,S=[],x,T=NaN,N=NaN,C=NaN,k=NaN,L={width:100,height:100},A={width:100,height:100},O=1;r.addEventListener("mousedown",B),r.addEventListener("touchstart",B),r.addEventListener("wheel",P),window.addEventListener("resize",q),a.style.WebkitTransformOrigin=a.style.transformOrigin="0 0",I(),this.updateContainerBounds=I,this.reset=M,this.setToCenter=R,this.animateToCenter=U,this.setScale=W,this.settingUpdated=z,this.resized=q}return u}),define("views/canvasview",["util/addpublishers","util/el","views/panzoom"],function(e,t,n){function r(i,s){function m(e){u.dblclick.dispatch()}function g(e){l.style.width=e.width+"px",l.style.height=e.height+"px";if(a.width!==e.width||a.height!==e.height)c.width=e.width,c.height=e.height,a.width=e.width,a.height=e.height,p.animateToCenter(),u.imagesizechange.dispatch();h.putImageData(e,0,0),p.updateContainerBounds()}function y(e){return function(){e(c.toDataURL("image/jpeg",100))}}function b(){clearTimeout(d),f.classList.remove("is-visible")}function w(){clearTimeout(d),d=setTimeout(function(){f.classList.add("is-visible")},400)}if(!(this instanceof r))return new r(i,s);var o=this,u=e(o,"update","imagesizechange","scale","dblclick"),a={width:0,height:0},f=t.createEl("div","panzoom",i),l=t.createEl("div","canvas-wrapper",f),c=t.createEl("canvas","glitch-canvas",l),h=c.getContext("2d"),p=n(l,f).on("scale",function(e){u.scale.dispatch(e),u.update.dispatch("scale",e)}),d=NaN,v=Date.now();f.addEventListener("dblclick",m),o.putImageData=g,o.moveToCenter=p.moveToCenter,o.animateToCenter=p.animateToCenter,o.setScale=p.setScale,o.createImageUrl=y,o.hide=b,o.show=w,o.resized=p.resized,o.el=f,o.panZoom=p}return r}),define("views/canvascontrolsview",["util/addpublishers","util/el"],function(e,t){function n(r){function f(e){s.center.dispatch()}function l(e){o||(s.scale.dispatch(parseFloat(a.value)),s.update.dispatch("scale",parseFloat(a.value)))}function c(e){s.scale.dispatch(1),s.update.dispatch("scale",1)}function h(e){return o=!0,a.value=e,o=!1,i}function p(e,t){return e==="scale"&&h(t),i}if(!(this instanceof n))return new n(r);var i=this,s=e(i,"update","center","scale"),o=!1,u=t.createEl("div","workspace-controls clear",r);t.createButton("controls.center","controls.centertitle","center-button button",u,f),t.createButton("controls.original","controls.originaltitle","scale-to-original-button button",u,c),t.createLabel("controls.zoom","control.zoomtitle","scale-label",u);var a=t.createEl("input","scale-slider",u);a.id="zoom",a.type="range",a.min=.01,a.max=5,a.step=.001,a.addEventListener("input",l),a.addEventListener("change",l),i.setScale=h,i.setValue=p,i.el=u}return n}),define("views/saveview",["util/el","util/addpublishers","util/browser","views/dialog","util/time"],function(e,t,n,r,i){function s(o){function m(e){c.toggle(),a.savetolocalstorage.dispatch()}function g(e,t){t=t||"glitched";var n=t.split("/"),r=n.length>1?n.pop():n[0];r=r.split(".").shift(),p=new Date,d=i.dateTimeToLocalStr(p);var s=r+"-glitched-"+d+".png";s=s.replace(/(\s|\/|:)/gmi,"-"),h.setAttribute("download",s),h.href=e}function y(){v=!0,a.show.dispatch()}function b(){v=!1}function w(){return v}if(!(this instanceof s))return new s(o);var u=this,a=t(u,"savetolocalstorage","show"),f,l,c,h,p,d,v=!1;n.test("localforage")&&(l=e.createButton("file.saveinbrowser","file.saveinbrowsertitle","nav-button save-view-button",o),c=r("save-dialog",o,l),h=e.createLink("file.download","file.downloadtitle",null,null,"download-link button"),h.target="_blank",f=e.createButton("file.save","file.savetitle","save-button button",null,m),c.on("show",y).on("hide",b).add(f,h)),u.updateDownloadLink=g,u.getActive=w}return s}),define("views/shareview",["config","util/addpublishers","views/dialog","util/el","util/browser","util/time","util/string","util/localizetext"],function(e,t,n,r,i,s,o,u){function a(f){function H(){d&&(c.share.dispatch(),R())}function B(e,t){clearTimeout(h);var n="https://imgur.com/"+t;p.el.classList.add("has-links"),C.textContent=e,C.href=e,C.setAttribute("data-imgurid",t),k.href=n,L.href=Y("reddit",e,n),A.href=Y("twitter",e,n),O.href=Y("facebook",e,n),M.href=Y("pinterest",e,n),_.href=Y("vkontakte",e,n)}function j(){p.el.classList.remove("has-links"),C.textContent="",C.href="about:blank",L.href="about:blank",A.href="about:blank",O.href="about:blank"}function F(){p.el.classList.add(g)}function I(){p.el.classList.remove(g)}function q(e,t,n){B(e,t),U()}function R(e){return p.el.classList.remove(m),clearTimeout(h),h=setTimeout(j,400),l}function U(){return p.el.classList.add(m),l}function z(){return d=!0,T.removeAttribute(w),l}function W(){return d=!1,T.setAttribute(w,w),l}function X(e){if(D){if(e&&Object.keys(e).length){var t;for(var n in e)t=D.querySelector('[data-uid="'+n+'"]'),e[n].deleteHash&&!t?V(n,e[n]):!e[n].deleteHash&&t&&$(t);var r=D.querySelectorAll("[data-uid]");for(var i=0,s=r.length;i<s;i++){var o=r[i].getAttribute("data-uid");o&&!e[o]&&$(r[i])}}Q(e)?D.wrapperEl.classList.remove(y):D.wrapperEl.classList.add(y)}return l}function V(e,t){if(t){var n=s.timestampToDate(t.timestamp),i=r.createEl("li","entry clear dialog-list-item",D);i.setAttribute("data-uid",e);var o=r.createEl("img","entry-thumb",i);o.src=t.thumbnail,o.addEventListener("click",K(e));var a=r.createEl("p","entry-text",i),f=r.createEl("p","entry-name",a);t.name?f.textContent=t.name:u(f,"textContent","file.untitled");var l=r.createEl("time","entry-datetime",a);l.setAttribute("datetime",n.toISOString());var c=r.createEl("span","entry-date",l);c.textContent=s.dateToLocalStr(n);var h=r.createEl("span","entry-time",l);h.textContent=s.timeToLocalStr(n);var p=r.createEl("div","entry-button-wrapper",i);r.createLink("file.openlink","file.openlinktitle",t.publicUrl,b,"open-link-button button "+v,p),r.createButton("file.offline","file.offlinetitle","item-offline-button button "+v,p,J(e,t.deleteHash))}}function $(e){e.parentNode.removeChild(e)}function J(e,t){return function(){var n=D.querySelector('[data-uid="'+e+'"] .item-offline-button');n&&n.setAttribute(w,w),c.deletefromimgur.dispatch(e,t)}}function K(e){return function(){p.hide(),c.openfromlocalstorage.dispatch(e)}}function Q(e){var t=!1;for(var n in e)if(e[n].deleteHash){t=!0;break}return t}function G(e,t){if(t.type==="imgurremovefail"&&t.uid){var n=D.querySelector('[data-uid="'+t.uid+'"] .item-offline-button');n&&n.removeAttribute(w)}}function Y(t,n,r){var i=u("share.link.description.edited"),s=u("share.link.title"),a={};return["reddit","vkontakte"].indexOf(t)!==-1&&(a.title=s),["pinterest","vkontakte"].indexOf(t)!==-1&&(a.description=i+" "+e.share.appURL,a.url=e.appURL),t==="pinterest"&&(a.media=n),t==="vkontakte"&&(a.image=n),t==="reddit"&&(a.url=n),t==="facebook"&&(a.u=r),t==="twitter"&&(a.text=u("share.link.description.withname")+" "+n+" "+e.share.appURL),e.share.sharer[t]+"?"+o.objToQueryStr(a)}function Z(e){return function(){return u(e)}}if(!(this instanceof a))return new a(f);var l=this,c=t(l,"share","deletefromimgur"),h=NaN,p,d=!0,v="is-online-only",m="was-loaded",g="is-loading",y="is-empty",b="_blank",w="disabled",E=r.createButton("share.share","share.sharetitle","nav-button share-toggle-button "+v,f),S=r.createEl("span","upload-status");u(S,"textContent","share.uploading");var x=r.createEl("p","share-info");u(x,"innerHTML","share.info");var T=r.createButton("share.upload","share.uploadtitle","upload-button button "+v,null,H),N=r.createLabel("share.imagelink","img-link-input","img-link-label label"),C=r.createLink(null,"share.opennewtabtitle",null,b,"img-link");C.id="img-link-input";var k=r.createLink(null,null,null,b,"imgur-link button");u(k,"textContent","share.openon",Z("share.target.imgur")),u(k,"title","share.openontitle",Z("share.target.imgur"));var L=r.createLink(null,null,null,b,"reddit-link button");u(L,"textContent","share.shareon",Z("share.target.reddit")),u(L,"title","share.shareontitle",Z("share.target.reddit"));var A=r.createLink(null,null,null,b,"twitter-link button");u(A,"textContent","share.shareon",Z("share.target.twitter")),u(A,"title","share.shareontitle",Z("share.target.twitter"));var O=r.createLink(null,null,null,b,"facebook-link button");u(O,"textContent","share.shareon",Z("share.target.facebook")),u(O,"title","share.shareontitle",Z("share.target.facebook"));var M=r.createLink(null,null,null,b,"pinterest-link button");u(M,"textContent","share.shareon",Z("share.target.pinterest")),u(M,"title","share.shareontitle",Z("share.target.pinterest"));var _=r.createLink(null,null,null,b,"vkontakte-link button");u(_,"textContent","share.shareon",Z("share.target.vkontakte")),u(_,"title","share.shareontitle",Z("share.target.vkontakte"));var D;p=n("share-dialog",f,E).add(v,x).add(v,T).add(v,"loader",S).add(v,N,C).add(v,k).add(v,L).add(v,A).add(v,O).add(v,M).add(v,_);if(i.test("localforage")){D=r.createEl("ul","shared-list dialog-list");var P=r.createLabel("share.recentlyshared",null,"load-label label");p.add("has-list shared-list",P,D)}l.showUpload=F,l.hideUpload=I,l.showShareLinks=U,l.hideShareLinks=R,l.uploadComplete=q,l.updateList=X,l.showOnlineOptions=z,l.hideOnlineOptions=W,l.handleError=G}return a}),define("views/indicatorview",["util/el","util/localizetext"],function(e,t){function n(r){function c(e,t,n){d("welcome",e,t,n)}function h(e,t){d("message",e,t)}function p(e,t){d("error",e,t)}function d(e,t,n,r){r=r||f[e]||7e3,a?s.push({type:e,message:t,data:n,fadeOutDelay:r}):v(e,{message:t,data:n,fadeOutDelay:r})}function v(n,r){var i=e.createEl("div","notification notification-"+n,l);r.data&&r.data.innerHTML?r.data.args&&r.data.args.length?t.apply(null,[i,"innerHTML",r.message].concat(r.data.args)):t.apply(null,[i,"innerHTML",r.message]):t(i,"textContent",r.message),i.id="notification-"+Date.now(),i.addEventListener("click",y),l.classList.add("is-active"),a=!0,requestAnimationFrame(function(){i.classList.add("is-active"),i.classList.add("is-visible"),u++}),setTimeout(function(){a=!1,m()},400),setTimeout(function(){g(i)},r.fadeOutDelay)}function m(){if(s.length&&u<4){var e=s.shift();v(e.type,{message:e.message,data:e.data})}}function g(e){o.indexOf(e.id)===-1&&(o.push(e.id),requestAnimationFrame(function(){e.classList.remove("is-active")}),setTimeout(function(){requestAnimationFrame(function(){o.splice(o.indexOf(e.id),1),l.removeChild(e),u--,m(),l.children.length||l.classList.remove("is-active")})},500))}function y(e){e.target.classList.contains("notification")&&!e.target.classList.contains("notification-error")&&g(e.target)}if(!(this instanceof n))return new n(r);var i=this,s=[],o=[],u=0,a=!1,f={message:5e3,error:7e3,welcome:7e3},l=e.createEl("div","notifications",r);i.showMessage=h,i.showError=p,i.showWelcome=c}return n}),define("views/workspacenavview",["util/el"],function(e){function t(n){if(!(this instanceof t))return new t(n);var r=this,i=e.createEl("nav","workspace-nav",n);r.el=i}return t}),define("views/aboutview",["util/el","views/dialog","models/localisationmodel","util/localizetext"],function(e,t,n,r){function i(n){if(!(this instanceof i))return new i(n);var s=this,o=e.createButton("about.info","about.infotitle","nav-button info-button",n),u=t("about-dialog",n,o),a=e.createEl("div","about-content"),f=document.querySelector(".description");r(f,"innerHTML","index.description"),a.appendChild(f),u.add(a)}return i}),define("views/draganddropview",["util/browser","util/addpublishers"],function(e,t){function n(r){function u(e){e.preventDefault()}function a(e){o||(r.classList.add("drag-over"),o=!0),u(e)}function f(e){o&&(r.classList.remove("drag-over"),o=!1),u(e)}function l(e){u(e),e.dataTransfer&&e.dataTransfer.files&&e.dataTransfer.files[0]&&s.drop.dispatch(e.dataTransfer.files[0]),r.classList.remove("drag-over")}if(!(this instanceof n))return new n(r);var i=this,s=t(i,"drop"),o=!1;e.test("draganddrop")&&(document.addEventListener("drop",l,!1),document.addEventListener("dragover",a,!1),document.addEventListener("dragleave",f,!1))}return n}),define("views/workspaceview",["util/addpublishers"],function(e){function t(n){if(!(this instanceof t))return new t(n);var r=this,i=e(r,"click"),s=document.createElement("div");s.classList.add("workspace"),n.appendChild(s),s.addEventListener("click",i.click.dispatch,!0),r.el=s}return t}),define("views/welcomeview",["util/addpublishers"],function(e){function t(){function o(){var e=["welcome.firstvisit.0","welcome.firstvisit.1","welcome.firstvisit.2"];e.forEach(function(e,t){setTimeout(function(){r.message.dispatch(e,18e3)},t*3e3)})}function u(e){i%4===1}function a(e){i=e}if(!(this instanceof t))return new t;var n=this,r=e(n,"message"),i=0,s=!1;n.show=o,n.updateVisits=a,n.showLanguageHint=u}return t}),define("views/settingsview",["util/el","views/dialog","util/addpublishers","util/localizetext"],function(e,t,n,r){function i(s){function c(e,t,n){f.el.querySelector("#setting-"+e)||(e==="language"?f.add("is-online-only",h(e,t,n)):f.add(h(e,t,n)))}function h(t,n,i){var s=e.createEl("div","setting"),o=e.createLabel("settings."+t.toLowerCase(),"setting-"+t,"setting-label",s),u;if(i){if(Array.isArray(i)){u=e.createEl("select","setting-input setting-select",s);var a;i.forEach(function(i){a=e.createEl("option",null,u),a.value=i,r(a,"textContent","settings."+t+"options."+i),i===n&&(a.selected=!0)})}}else typeof n=="boolean"&&(u=e.createEl("input","setting-input setting-checkbox",s),u.type="checkbox",n===!0&&(u.checked=!0));return u&&(u.id="setting-"+t,u.setAttribute("data-setting",t),u.addEventListener("change",p)),s}function p(e){var t=e.target;if(e.target.classList.contains("setting-input")){var n=e.target,r=n.getAttribute("data-setting"),i;n.classList.contains("setting-checkbox")?i=n.checked:n.classList.contains("setting-select")&&(i=n.value),typeof i!="undefined"&&u.settingchange.dispatch(r,i)}}function d(e,t,n){cancelAnimationFrame(l[e]),l[e]=requestAnimationFrame(function(){c(e,t,n);var r=f.el.querySelector('.setting-checkbox[data-setting="'+e+'"]');if(r){r.classList.contains("setting-checkbox")&&r.checked!==t&&(r.checked=t);if(r.classList.contains("setting-select")&&r.value!==t){var i=r.querySelector("option"),s,o;for(var u=0,a=i.length;u<a;u++)s=i[u],o=s.value,o===t&&!s.selected&&(s.selected=!0),o!==t&&s.selected&&(s.selected=!1)}}})}if(!(this instanceof i))return new i(s);var o=this,u=n(o,"settingchange"),a=e.createButton("settings.settings","settings.settingstitle","nav-button settings-button",s),f=t("settings-dialog",s,a),l={};o.settingUpdated=d}return i}),define("models/controlsmodel",["util/object","util/addpublishers"],function(e,t){function n(r){function a(t){if(t){t=e.getCopy(t);var n,r;for(var a in t)limit=o[a],r=t[a],typeof limit!="undefined"&&typeof r=="number"&&!isNaN(r)&&r>=limit.min&&r<=limit.max&&u[a]!==r&&(u[a]=r,s.update.dispatch(a,u[a]))}return i}function f(e,t){return typeof u[e]=="number"&&typeof t=="number"&&!isNaN(t)&&(u[e]=t,s.update.dispatch(e,u[e])),i}function l(){var e={};for(var t in o)e[t]=parseInt(Math.random()*(o[t].max-o[t].min)+o[t].min,10);return a(e),i}function c(t){var n={};t=t||u;for(var r in t)typeof t[r].value=="number"?n[r]=t[r].value:n[r]=t[r];return e.getCopy(n)}function h(t){var n={};for(var r in t)n[r]={min:t[r].min,max:t[r].max};return e.getCopy(n)}if(!(this instanceof n))return new n(r);var i=this,s=t(i,["update"]),o=h(r)||{},u=c(r)||{};i.randomizeValues=l,i.setValue=f,i.getValues=c}return n}),define("util/canvas",[],function(){function n(n,r,i,s){function l(){f&&o.src===n?(e.width=o.naturalWidth,e.height=o.naturalHeight,u=Math.min(r.width/o.naturalWidth,r.height/o.naturalHeight),t.drawImage(o,0,0),o.src=e.toDataURL("image/png",1)):(e.width=r.width,e.height=r.height,t.scale(u,u),t.drawImage(o,0,0),s==="both"?i({dataURL:e.toDataURL("image/png",1),imageData:t.getImageData(0,0,e.width,e.height)}):f||s==="asDataURL"?i(e.toDataURL("image/png",1)):a||s==="asImageData"?i(t.getImageData(0,0,e.width,e.height)):i())}var o=new Image,u=1,a=!1,f=!1;o.addEventListener("load",l),typeof n=="string"&&(f=!0,o.src=n),n.width&&n.height&&n.data&&n.data.length&&(a=!0,e.width=n.width,e.height=n.height,u=Math.min(r.width/n.width,r.height/n.height),t.putImageData(n,0,0),o.src=e.toDataURL("image/png",1)),!f&&!a&&i(!1)}var e=document.createElement("canvas"),t=e.getContext("2d");return{resizeImage:n}}),define("models/imagemodel",["util/browser","util/addpublishers","util/time","util/canvas","util/localizetext"],function(e,t,n,r,i){function s(){function g(e){return h&&(d=e.name,c.readAsDataURL(e)),o}function y(e){return w(),a.width=e.width||e.videoWidth||e.clientWidth,a.height=e.height||e.videoHeight||e.clientHeight,f.translate(a.width,0),f.scale(-1,1),f.drawImage(e,0,0),p=a.toDataURL("image/png"),d=i("webcam.picture",n.dateTimeToLocalStr(new Date)),N(f.getImageData(0,0,a.width,a.height),u.load.dispatch),o}function b(e,t){return t&&(d=t),e=decodeURIComponent(e),u.update.dispatch("img",e,t),e&&l.src!==e?(l.src="",p=e,l.src=e):E(),o}function w(){f.clearRect(0,0,a.width,a.height)}function E(){var e=k(l);N(e,u.load.dispatch)}function S(e){u.error.dispatch("file.error.openimage",l.src)}function x(e){b(e.target.result)}function T(e){u.error.dispatch("file.error.openfile")}function N(e,t){if(m&&e.data&&e.data.length/4>v){var n=e.width/e.height,i=e.height/e.width,s=Math.round(Math.sqrt(v/n)),o=Math.round(s*i),a={width:s,height:o};u.statusmessage.dispatch("file.message.resize"),r.resizeImage(e,a,function(e){t(e.imageData),typeof e.dataURL=="string"&&(p=e.dataURL)},"both")}else t(e)}function C(e,t){e==="resizeUploadedImages"&&typeof t=="boolean"&&(m=t)}function k(e){return w(),a.width=e.naturalWidth,a.height=e.naturalHeight,f.drawImage(e,0,0,e.naturalWidth,e.naturalHeight),f.getImageData(0,0,e.naturalWidth,e.naturalHeight)}function L(e){return p}function A(e){return d}if(!(this instanceof s))return new s;var o=this,u=t(o,["load","update","error","statusmessage"]),a=document.createElement("canvas"),f=a.getContext("2d"),l=new Image,c,h=!1,p,d,v=.8*Math.pow(1e3,2),m=!0;if(c=e.getFeature(window,"FileReader"))c=new c,h=!0,c.addEventListener("load",x),c.addEventListener("error",T);l.addEventListener("load",E),l.addEventListener("error",S),o.loadFromFile=g,o.loadFromVideo=y,o.getLastImageSRC=L,o.getLastFileName=A,o.loadFromURL=b,o.settingUpdated=C}return s}),function(e,t){typeof define=="function"&&define.amd?define("lib/glitch-canvas-with-worker",t):typeof exports=="object"?module.exports=t():e.glitch=t()}(this,function(){function e(t){function b(){return t&&"Worker"in window?(p=new Worker(t),p.addEventListener("message",E,!1)):(d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",v=d.split(""),m={},v.forEach(function(e,t){m[e]=t})),n}function w(e,t,o){if(k(e)&&L(t,"parameters","object")&&L(o,"callback","function")){T(r,e),T(i,e),h=N(t),a=C(e,h.quality),u.onload=function(){s.drawImage(u,0,0),f=s.getImageData(0,0,e.width,e.height),o(f),u.onload=null};if(p)p.postMessage({glitch:{base64:a,parameters:h}});else{g=D(a),y=H(g);for(l=0,c=h.iterations;l<c;l++)_(g,y,h.seed,h.amount,l,h.iterations);u.src=P(g)}}return n}function E(e){e&&e.data&&e.data.glitched?x(e.data.glitched):window.console&&console.log("glitchworker response",e.data)}function S(e){window.console&&console.log(e.message||e)}function x(e){u.src=e}function T(e,t){e.width!==t.width&&(e.width=t.width),e.height!==t.height&&(e.height=t.height)}function N(e){return{seed:(e.seed||0)/100,quality:(e.quality||0)/100,amount:(e.amount||0)/100,iterations:e.iterations||0}}function C(e,t){var n=typeof t=="number"&&t<1&&t>0?t:.1;o.putImageData(e,0,0);var r=i.toDataURL("image/jpeg",n);switch(r.length%4){case 3:r+="=";break;case 2:r+="==";break;case 1:r+="==="}return r}function k(e){return L(e,"imageData","object")&&L(e.width,"imageData.width","number")&&L(e.height,"imageData.height","number")&&L(e.data,"imageData.data","object")&&L(e.data.length,"imageData.data.length","number")&&A(e.data.length,"imageData.data.length",O,"> 0")?!0:!1}function L(e,t,n){return typeof e===n?!0:(M(e,"typeof "+t,'"'+n+'"','"'+typeof e+'"'),!1)}function A(e,t,n,r){if(n(e)===!0)return!0;M(e,t,r,"not")}function O(e){return e>0}function M(e,t,n,r){throw new Error("glitch(): Expected "+t+" to be "+n+", but it was "+r+".")}function _(e,t,n,r,i,s){var o=e.length-t-4,u=parseInt(o/s*i,10),a=parseInt(o/s*(i+1),10),f=a-u,l=parseInt(u+f*n,10);l>o&&(l=o);var c=Math.floor(t+l);e[c]=Math.floor(r*256)}function D(e){var t=[],n,r,i;for(l=23,c=e.length;l<c;l++){r=m[e.charAt(l)],n=(l-23)%4;switch(n){case 1:t.push(i<<2|r>>4);break;case 2:t.push((i&15)<<4|r>>2);break;case 3:t.push((i&3)<<6|r)}i=r}return t}function P(e){var t=["data:image/jpeg;base64,"],n,r,i;for(l=0,c=e.length;l<c;l++){r=e[l],n=l%3;switch(n){case 0:t.push(v[r>>2]);break;case 1:t.push(v[(i&3)<<4|r>>4]);break;case 2:t.push(v[(i&15)<<2|r>>6]),t.push(v[r&63])}i=r}return n===0?(t.push(v[(i&3)<<4]),t.push("==")):n===1&&(t.push(v[(i&15)<<2]),t.push("=")),t.join("")}function H(e){var t=417;for(l=0,c=e.length;l<c;l++)if(e[l]===255&&e[l+1]===218){t=l+2;break}return t}if(!(this instanceof e))return new e(t);var n=this,r=document.createElement("canvas"),i=document.createElement("canvas"),s=r.getContext("2d"),o=i.getContext("2d"),u=new Image,a,u,f,l,c,h,p,d,v,m,g,y;n.glitch=w,n.init=b}return e}),define("models/glitchmodel",["config","lib/glitch-canvas-with-worker","util/addpublishers","util/canvas"],function(e,t,n,r){function i(){function d(){u&&a&&p.glitch(a,u,v)}function v(e){f=e,o.glitch.dispatch(e)}function m(e,t){u[e]!==t&&(u[e]=t,h=setTimeout(d,10))}function g(e){a=e,d()}function y(e,t,n){return a&&(t=t||{width:50,height:50},typeof t=="string"&&t==="original"&&(t={width:f.width,height:f.height}),r.resizeImage(f,t,function(t){n=Array.prototype.slice.call(n||[]),n.unshift(t),e.apply(e,n)},"asDataURL")),s}function b(e,t){return function(){y(e,t,arguments)}}if(!(this instanceof i))return new i;var s=this,o=n(s,"glitch"),u={},a,f,l=document.createElement("canvas"),c=new Image,h=NaN,p=t(e.workers.glitch).init();s.setValue=m,s.setImageData=g,s.generateImageURL=y,s.getImageGenerationFn=b}return i}),function(e){"use strict";function t(e,t){var n=(e&65535)+(t&65535),r=(e>>16)+(t>>16)+(n>>16);return r<<16|n&65535}function n(e,t){return e<<t|e>>>32-t}function r(e,r,i,s,o,u){return t(n(t(t(r,e),t(s,u)),o),i)}function i(e,t,n,i,s,o,u){return r(t&n|~t&i,e,t,s,o,u)}function s(e,t,n,i,s,o,u){return r(t&i|n&~i,e,t,s,o,u)}function o(e,t,n,i,s,o,u){return r(t^n^i,e,t,s,o,u)}function u(e,t,n,i,s,o,u){return r(n^(t|~i),e,t,s,o,u)}function a(e,n){e[n>>5]|=128<<n%32,e[(n+64>>>9<<4)+14]=n;var r,a,f,l,c,h=1732584193,p=-271733879,d=-1732584194,v=271733878;for(r=0;r<e.length;r+=16)a=h,f=p,l=d,c=v,h=i(h,p,d,v,e[r],7,-680876936),v=i(v,h,p,d,e[r+1],12,-389564586),d=i(d,v,h,p,e[r+2],17,606105819),p=i(p,d,v,h,e[r+3],22,-1044525330),h=i(h,p,d,v,e[r+4],7,-176418897),v=i(v,h,p,d,e[r+5],12,1200080426),d=i(d,v,h,p,e[r+6],17,-1473231341),p=i(p,d,v,h,e[r+7],22,-45705983),h=i(h,p,d,v,e[r+8],7,1770035416),v=i(v,h,p,d,e[r+9],12,-1958414417),d=i(d,v,h,p,e[r+10],17,-42063),p=i(p,d,v,h,e[r+11],22,-1990404162),h=i(h,p,d,v,e[r+12],7,1804603682),v=i(v,h,p,d,e[r+13],12,-40341101),d=i(d,v,h,p,e[r+14],17,-1502002290),p=i(p,d,v,h,e[r+15],22,1236535329),h=s(h,p,d,v,e[r+1],5,-165796510),v=s(v,h,p,d,e[r+6],9,-1069501632),d=s(d,v,h,p,e[r+11],14,643717713),p=s(p,d,v,h,e[r],20,-373897302),h=s(h,p,d,v,e[r+5],5,-701558691),v=s(v,h,p,d,e[r+10],9,38016083),d=s(d,v,h,p,e[r+15],14,-660478335),p=s(p,d,v,h,e[r+4],20,-405537848),h=s(h,p,d,v,e[r+9],5,568446438),v=s(v,h,p,d,e[r+14],9,-1019803690),d=s(d,v,h,p,e[r+3],14,-187363961),p=s(p,d,v,h,e[r+8],20,1163531501),h=s(h,p,d,v,e[r+13],5,-1444681467),v=s(v,h,p,d,e[r+2],9,-51403784),d=s(d,v,h,p,e[r+7],14,1735328473),p=s(p,d,v,h,e[r+12],20,-1926607734),h=o(h,p,d,v,e[r+5],4,-378558),v=o(v,h,p,d,e[r+8],11,-2022574463),d=o(d,v,h,p,e[r+11],16,1839030562),p=o(p,d,v,h,e[r+14],23,-35309556),h=o(h,p,d,v,e[r+1],4,-1530992060),v=o(v,h,p,d,e[r+4],11,1272893353),d=o(d,v,h,p,e[r+7],16,-155497632),p=o(p,d,v,h,e[r+10],23,-1094730640),h=o(h,p,d,v,e[r+13],4,681279174),v=o(v,h,p,d,e[r],11,-358537222),d=o(d,v,h,p,e[r+3],16,-722521979),p=o(p,d,v,h,e[r+6],23,76029189),h=o(h,p,d,v,e[r+9],4,-640364487),v=o(v,h,p,d,e[r+12],11,-421815835),d=o(d,v,h,p,e[r+15],16,530742520),p=o(p,d,v,h,e[r+2],23,-995338651),h=u(h,p,d,v,e[r],6,-198630844),v=u(v,h,p,d,e[r+7],10,1126891415),d=u(d,v,h,p,e[r+14],15,-1416354905),p=u(p,d,v,h,e[r+5],21,-57434055),h=u(h,p,d,v,e[r+12],6,1700485571),v=u(v,h,p,d,e[r+3],10,-1894986606),d=u(d,v,h,p,e[r+10],15,-1051523),p=u(p,d,v,h,e[r+1],21,-2054922799),h=u(h,p,d,v,e[r+8],6,1873313359),v=u(v,h,p,d,e[r+15],10,-30611744),d=u(d,v,h,p,e[r+6],15,-1560198380),p=u(p,d,v,h,e[r+13],21,1309151649),h=u(h,p,d,v,e[r+4],6,-145523070),v=u(v,h,p,d,e[r+11],10,-1120210379),d=u(d,v,h,p,e[r+2],15,718787259),p=u(p,d,v,h,e[r+9],21,-343485551),h=t(h,a),p=t(p,f),d=t(d,l),v=t(v,c);return[h,p,d,v]}function f(e){var t,n="";for(t=0;t<e.length*32;t+=8)n+=String.fromCharCode(e[t>>5]>>>t%32&255);return n}function l(e){var t,n=[];n[(e.length>>2)-1]=undefined;for(t=0;t<n.length;t+=1)n[t]=0;for(t=0;t<e.length*8;t+=8)n[t>>5]|=(e.charCodeAt(t/8)&255)<<t%32;return n}function c(e){return f(a(l(e),e.length*8))}function h(e,t){var n,r=l(e),i=[],s=[],o;i[15]=s[15]=undefined,r.length>16&&(r=a(r,e.length*8));for(n=0;n<16;n+=1)i[n]=r[n]^909522486,s[n]=r[n]^1549556828;return o=a(i.concat(l(t)),512+t.length*8),f(a(s.concat(o),640))}function p(e){var t="0123456789abcdef",n="",r,i;for(i=0;i<e.length;i+=1)r=e.charCodeAt(i),n+=t.charAt(r>>>4&15)+t.charAt(r&15);return n}function d(e){return unescape(encodeURIComponent(e))}function v(e){return c(d(e))}function m(e){return p(v(e))}function g(e,t){return h(d(e),d(t))}function y(e,t){return p(g(e,t))}function b(e,t,n){return t?n?g(t,e):y(t,e):n?v(e):m(e)}typeof define=="function"&&define.amd?define("lib/md5",[],function(){return b}):e.md5=b}(this),define("models/storagemodel",["config","util/browser","util/addpublishers","lib/md5","lib/localforage.nopromises","models/localisationmodel"],function(e,t,n,r,i,s){function o(){function d(e){if(l&&e)if(c)S("add",e);else{var t=x(e);f[t]&&f[t].deleteHash===e.deleteHash&&f[t].publicUrl===e.publicUrl&&f[t].imgurID===e.imgurID?p.statusmessage.dispatch("file.message.before"):(e.timestamp=Date.now(),f[t]=e,b(function(){p.statusmessage.dispatch("file.message.save")}))}return s}function v(e){l&&e&&(c?S("removeCompletely",e):f[e]&&(f[e].deleteHash||f[e].publicUrl||f[e].imgurID||f[e].values||f[e].src)?console&&console.log("cant delete storage item because theres still some data left",f[e]):(p.removeall.dispatch(f[e]),delete f[e],b(function(){p.statusmessage.dispatch("file.message.del")})))}function m(e){return l&&e&&(c?S("removeLocalData",e):f[e]&&(f[e].src&&(delete f[e].src,p.removelocaldata.dispatch(f[e])),f[e].values&&delete f[e].values,f[e].deleteHash||f[e].publicUrl||f[e].imgurID||v(e),b())),s}function g(e){return l&&e&&(c?S("removeImgurData",e):f[e]&&(f[e].deleteHash&&(p.removeimgurdata.dispatch(f[e]),delete f[e].deleteHash),f[e].publicUrl&&delete f[e].publicUrl,f[e].imgurID&&delete f[e].imgurID,!f[e].src&&!f[e].values&&v(e),b())),s}function y(e){return l&&(c?S("load"):i.getItem(storageKey,function(t,n){t?(p.error.dispatch("file.error.load"),console&&console.log("localforage error",t)):(f=n&&n.entries?n.entries:{},p.update.dispatch(f),a=n&&n.visitCount?n.visitCount:1,u=n&&n.lastVisit?!1:!0,u&&p.firstvisit.dispatch(),b(),a&&p.visitCount.dispatch(a),typeof e=="function"&&e())})),s}function b(e){return l&&(c?S("save"):i.setItem(storageKey,{entries:f,lastVisit:Date.now(),visitCount:a+1},function(t,n){t?(p.error.dispatch("file.error.save"),console&&console.log("localforage error",t)):n?(f=n.entries,p.update.dispatch(f),p.save.dispatch(),typeof e=="function"&&e()):console&&console.log("no data was saved",n)})),s}function w(e){return l&&(c?S("loadItem",e):f[e]&&p.loaditem.dispatch(e,f[e])),s}function E(e){e&&e.data&&h.forEach(function(t){typeof e.data[t]!="undefined"&&(t==="loaditem"?p[t].dispatch(e.data[t].uid,e.data[t].entries):p[t]===t?p[t].dispatch():p[t].dispatch(e.data[t]))})}function S(e,t){if(typeof e=="string"){typeof t=="undefined"&&(t=e);var n={};n[e]=t,c.postMessage(n)}}function x(e){var t="N"+e.name+"S"+e.src+"L"+e.thumbnail.length||"0V";for(var n in e.values)t+=n.substr(0,2),t+=e.values[n];return r(t)}function T(){var e,t,n;for(var r in f)n=f[r].timestamp,n&&(!e||n>t)&&(e=r,t=n);return e}if(!(this instanceof o))return new o;var s=this,u=!1,a=0,f={},l=t.test("localforage")&&i,c,h=["update","save","loaditem","removeall","removelocaldata","removeimgurdata","visits","firstvisit","error","statusmessage"],p=n(s,h);storageKey=e.keys.storage,l&&t.test("webworker")&&t.test("browserdb")&&!t.test("safari")&&(c=new Worker(e.workers.storage),c.addEventListener("message",E,!1),S("setStorageKey",storageKey)),s.add=d,s.removeImgurData=g,s.removeLocalData=m,s.load=y,s.loadItem=w,s.removeImgurData=g,s.getLatestUID=T}return o}),define("models/sharemodel",["config","lib/reqwest","util/addpublishers"],function(e,t,n){function r(){function u(){return s?(o.uploadstart.dispatch(),t({url:"https://api.imgur.com/3/image.json",method:"POST",headers:{Authorization:"Client-ID "+e.keys.imgur},data:{image:s.split(",")[1],type:"base64"},type:"json",crossOrigin:!0,success:a,error:f})):f(new Error("share.error.base64")),i}function a(e){o.uploadend.dispatch();if(e.status===200&&e.data&&e.data.link){var t=e.data.link.replace("http://","https://");o.uploadcomplete.dispatch(t,e.data.id,e.data.deletehash),o.statusmessage.dispatch("share.message.upload",{innerHTML:!0,args:[t]})}}function f(e){o.uploadend.dispatch(),o.error.dispatch("share.error.upload",{type:"imguruploadfail"}),console&&console.log(e.message||e)}function l(e){return s=e,i}function c(n,r){return r&&(o.removestart.dispatch(n),t({url:"https://api.imgur.com/3/image/"+r,method:"DELETE",headers:{Authorization:"Client-ID "+e.keys.imgur},crossOrigin:!0,success:function(){h(n)},error:function(e){p(n,e)}})),i}function h(e){o.removeend.dispatch(e),o.removecomplete.dispatch(e),o.statusmessage.dispatch("share.message.del")}function p(e,t){o.removeend.dispatch(e),o.error.dispatch("share.error.del",{type:"imgurremovefail",uid:e}),console&&console.log(t.message||t)}if(!(this instanceof r))return new r;var i=this,s,o=n(i,"uploadstart","uploadend","uploadcomplete","removestart","removeend","removecomplete","error","statusmessage");i.upload=u,i.updateUrl=l,i.remove=c}return r}),define("models/networkmodel",["util/addpublishers"],function(e){function t(){function s(){return navigator.onLine!==i&&(i=navigator.onLine,r.connectivitychange.dispatch(i),i?r.connect.dispatch():r.disconnect.dispatch()),n}if(!(this instanceof t))return new t;var n=this,r=e(n,"connectivitychange","disconnect","connect"),i;window.addEventListener("online",s),window.addEventListener("offline",s),n.checkConnectivity=s}return t}),define("models/settingsmodel",["config","util/browser","util/object","util/addpublishers","lib/localforage.nopromises"],function(e,t,n,r,i){function s(){function d(e){return p[e]}function v(e){var t=d(e);if(t)return t.value;return}function m(){return n.getCopy(p)}function g(e,t){var n=!1;return typeof e=="string"&&typeof p[e]!="undefined"&&typeof t==typeof p[e].value&&t!==p[e].value&&(p[e].value=t,n=!0),n&&(f?y(p):S(p)),o}function y(t){f&&(t=x(t),l?w("save",t):i.setItem(e.keys.settings,t,function(e,t){e?(sendError("settings.error.save"),console&&console.log("localforage error",e)):t?S(t):console&&console.log("no data was saved",t)}))}function b(){f?l?w("load"):i.getItem(e.keys.settings,function(e,t){e?(sendError("settings.error.load"),console&&console.log("localforage error",e)):S(t)}):S(p||c)}function w(e,t){if(typeof e=="string"){typeof t=="undefined"&&(t=e);var n={};n[e]=t,l.postMessage(n)}}function E(e){e&&e.data&&u.forEach(function(t){typeof e.data[t]!="undefined"&&(t==="update"?S(e.data[t]):a[t]===t?a[t].dispatch():a[t].dispatch(e.data[t]))})}function S(e){if(e){p=e||c;if(n.isEqual(x(p),p))for(var t in p)a.update.dispatch(t,p[t].value,p[t].options);else y(x(p))}else p=c,y(p)}function x(e){return e&&c&&e!==c&&(e=n.merge(e,c)),e}if(!(this instanceof s))return new s;var o=this,u=["update","error"],a=r(o,u),f=t.test("localforage")&&i,l,c=e.settings,h=(navigator.language||navigator.userLanguage||"").toLowerCase(),p={};f&&t.test("webworker")&&t.test("browserdb")&&!t.test("safari")?(l=new Worker(e.workers.settings),l.addEventListener("message",E,!1),w("setStorageKey",e.keys.settings),w("setDefaultSettings",c)):S(c),o.getSetting=d,o.getSettingValue=v,o.getSettings=m,o.setValue=g,o.load=b}return s}),requirejs.config({baseUrl:"scripts/",waitSeconds:10}),require(["config","util/browser","views/appview","views/navview","views/controlsview","views/openfileview","views/fullscreenview","views/webcamview","views/canvasview","views/canvascontrolsview","views/saveview","views/shareview","views/indicatorview","views/workspacenavview","views/aboutview","views/draganddropview","views/workspaceview","views/welcomeview","views/settingsview","models/controlsmodel","models/imagemodel","models/glitchmodel","models/storagemodel","models/sharemodel","models/networkmodel","models/settingsmodel","models/localisationmodel","lib/localforage.nopromises"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k){function et(){nt(),tt(),P.checkConnectivity(),t.test("localforage")&&k?rt(function(){_.load(),B.load()}):(B.load(),U.loadInitialValues(),it())}function tt(){U.on("update",D.setValue).on("random",D.randomizeValues),D.on("update",U.setValue).on("update",O.setValue).on("update",J.hideShareLinks),R.on("center",W.animateToCenter).on("scale",W.setScale),W.on("scale",R.setScale).on("dblclick",W.animateToCenter),X.on("openfile",A.loadFromFile).on("openfromlocalstorage",_.loadItem).on("deletefromlocalstorage",_.removeLocalData).on("deletefromimgur",M.remove),V.on("savetolocalstorage",O.getImageGenerationFn(st)).on("savetolocalstorage",at).on("show",at),F.on("toggleend",W.resized),A.on("load",O.setImageData).on("load",X.dialog.hide).on("load",W.animateToCenter).on("load",W.show).on("update",W.hide).on("error",z.showError).on("error",z.hideLoading).on("statusmessage",z.showMessage),O.on("glitch",W.putImageData).on("glitch",W.createImageUrl(M.updateUrl)).on("glitch",at),J.on("share",M.upload).on("deletefromimgur",M.remove),M.on("uploadstart",J.showUpload).on("uploadend",J.hideUpload).on("uploadcomplete",J.uploadComplete).on("uploadcomplete",O.getImageGenerationFn(st)).on("removecomplete",_.removeImgurData).on("removecomplete",J.hideShareLinks).on("error",z.showError).on("error",J.handleError).on("statusmessage",z.showMessage),$.on("video",A.loadFromVideo).on("error",z.showError),Y.on("drop",A.loadFromFile).on("drop",W.hide),Z.on("message",z.showWelcome),I.on("click",F.closeSmallScreenNav),Q.on("settingchange",B.setValue),_.on("update",X.updateList).on("update",J.updateList).on("update",it).on("loaditem",ot).on("statusmessage",z.showMessage).on("error",z.showError).on("visits",Z.updateVisits).on("firstvisit",Z.show),P.on("connect",J.showOnlineOptions).on("disconnect",J.hideOnlineOptions).on("connect",j.showOnlineOptions).on("disconnect",j.hideOnlineOptions),B.on("update",W.panZoom.settingUpdated).on("update",A.settingUpdated).on("update",Q.settingUpdated).on("update",H.settingUpdated).on("error",z.showError),H.on("error",z.showError).on("error",ft).on("newlanguage",Z.showLanguageHint).on("update",ft)}function nt(){t.test("touch")&&document.documentElement.classList.add("has-touch")}function rt(n){if(k){k.config(e.localForage);var r=[k.INDEXEDDB,k.WEBSQL,k.LOCALSTORAGE];t.test("safari")&&(r=k.LOCALSTORAGE),k.setDriver(r).then(n)}else typeof n=="function"&&n()}function it(t){var n=-1;if(t&&Object.keys(t).length){var r=Date.now(),i=Infinity;for(var s in t)t[s].timestamp&&r-t[s].timestamp<i&&(i=r-t[s].timestamp,n=s)}_.off("update",it),n!==-1?_.loadItem(n):(A.loadFromURL(e.defaultImage.path,e.defaultImage.name),U.loadInitialValues())}function st(e,t,n,r){var i={thumbnail:e,src:A.getLastImageSRC(),values:D.getValues(),name:A.getLastFileName()};t&&(i.publicUrl=t),n&&(i.imgurID=n),r&&(i.deleteHash=r),_.add(i)}function ot(e,t){for(var n in t.values)D.setValue(n,t.values[n]);A.loadFromURL(t.src,t.name)}function at(){V.getActive()&&(clearTimeout(ut),ut=setTimeout(function(){O.getImageGenerationFn(V.updateDownloadLink,"original")(A.getLastFileName())},200))}function ft(){L||requestAnimationFrame(function(){L=!0,document.documentElement.classList.add("is-loaded"),setTimeout(function(){document.documentElement.classList.remove("is-loading")},10)})}var L=!1,A=w(),O=E(),M=x(),_=S(),D=b(e.defaultControlParams),P=T(),H=C.sharedInstance,B=N(),j=n(document.body),F=r(j.el),I=m(j.el),q=p(I.el),R=f(q.el),U=i(q.el,R.el,e.defaultControlParams),z=h(I.el),W=a(I.el,F.el),X=s(F.el),V=l(F.el),$=u(F.el),J=c(F.el),K=d(F.el),Q=y(F.el),G=o(I.el),Y=v(W.el),Z=g(),ut=NaN;et()}),define("glitcher",function(){})})();